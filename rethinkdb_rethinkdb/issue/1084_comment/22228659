IssueComment
  { issueCommentUpdatedAt = 2013 (-08) (-07) 04 : 10 : 39 UTC
  , issueCommentUser =
      SimpleUser
        { simpleUserId = Id 552910
        , simpleUserLogin = N "Tryneus"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/552910?v=3"
        , simpleUserUrl = "https://api.github.com/users/Tryneus"
        , simpleUserType = OwnerUser
        }
  , issueCommentUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/comments/22228659"
  , issueCommentHtmlUrl =
      "https://github.com/rethinkdb/rethinkdb/issues/1084#issuecomment-22228659"
  , issueCommentCreatedAt = 2013 (-08) (-07) 04 : 10 : 39 UTC
  , issueCommentBody =
      "Sooo...progress perhaps?  `extent_t` does not wait for all of its `extent_block_t`s to get their `done` callback before destructing, which might cause this error if i/o takes long enough.  I'm not very familiar with the serializer code, but every other place that calls write on a `file_t` appears to wait for it to complete.  @srh, what do you think?\r\n\r\n```c\r\n[ RUN      ] RDBProtocol.SindexList\r\nVersion: rethinkdb 1.7.3-564-g80d97e (debug) (CLANG 3.2 (tags/RELEASE_32/final))\r\nerror: Error in ../src/serializer/log/lba/extent.cc at line 99:\r\nerror: Assertion failed: [active_extent_blocks == 0] \r\nerror: Backtrace:\r\nerror: Tue Aug  6 21:02:25 2013\r\n       \r\n       1: rethinkdb_backtrace(void**, int) at thread_stack_pcs.cc:150\r\n       2: lazy_backtrace_t::lazy_backtrace_t() at backtrace.cc:250\r\n       3: format_backtrace(bool) at backtrace.cc:197\r\n       4: report_fatal_error(char const*, int, char const*, ...) at errors.cc:68\r\n       5: extent_t::~extent_t() at extent.cc:99\r\n       6: extent_t::shutdown() at extent.cc:95\r\n       7: lba_disk_extent_t::shutdown() at disk_extent.hpp:58\r\n       8: lba_disk_structure_t::shutdown() at disk_structure.cc:316\r\n       9: lba_list_t::shutdown_now() at lba_list.cc:290\r\n       10: lba_list_t::shutdown(lba_list_t::shutdown_callback_t*) at lba_list.cc:283\r\n       11: log_serializer_t::next_shutdown_step() at log_serializer.cc:784\r\n       12: log_serializer_t::shutdown(cond_t*) at log_serializer.cc:742\r\n       13: log_serializer_t::~log_serializer_t() at log_serializer.cc:373\r\n       14: log_serializer_t::~log_serializer_t() at log_serializer.cc:370\r\n       15: scoped_ptr_t<log_serializer_t>::reset() at scoped.hpp:66\r\n       16: scoped_ptr_t<log_serializer_t>::~scoped_ptr_t() at scoped.hpp:29\r\n       17: scoped_ptr_t<log_serializer_t>::~scoped_ptr_t() at scoped.hpp:30\r\n       18: internal_disk_backed_queue_t::~internal_disk_backed_queue_t() at disk_backed_queue.cc:37\r\n       19: void boost::checked_delete<internal_disk_backed_queue_t>(internal_disk_backed_queue_t*) at checked_delete.hpp:34\r\n       20: boost::detail::sp_counted_impl_p<internal_disk_backed_queue_t>::dispose() at sp_counted_impl.hpp:79\r\n       21: boost::detail::sp_counted_base::release() at sp_counted_base_gcc_x86.hpp:146\r\n       22: boost::detail::shared_count::~shared_count() at shared_count.hpp:305\r\n       23: boost::detail::shared_count::~shared_count() at shared_count.hpp:309\r\n       24: boost::shared_ptr<internal_disk_backed_queue_t>::~shared_ptr() at shared_ptr.hpp:164\r\n       25: boost::shared_ptr<internal_disk_backed_queue_t>::~shared_ptr() at shared_ptr.hpp:164\r\n       26: boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >::~value() at bind.hpp:112\r\n       27: boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >::~value() at bind.hpp:112\r\n       28: boost::_bi::storage3<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> > >::~storage3() at storage.hpp:125\r\n       29: boost::_bi::storage4<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >, boost::_bi::value<auto_drainer_t::lock_t> >::~storage4() at storage.hpp:174\r\n       30: boost::_bi::list4<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >, boost::_bi::value<auto_drainer_t::lock_t> >::~list4() at bind.hpp:415\r\n       31: boost::_bi::list4<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >, boost::_bi::value<auto_drainer_t::lock_t> >::~list4() at bind.hpp:415\r\n       32: boost::_bi::bind_t<void, void (*)(std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > const&, btree_store_t<rdb_protocol_t>*, boost::shared_ptr<internal_disk_backed_queue_t>, auto_drainer_t::lock_t), boost::_bi::list4<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >, boost::_bi::value<auto_drainer_t::lock_t> > >::~bind_t() at bind.hpp:864\r\n       33: boost::_bi::bind_t<void, void (*)(std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > const&, btree_store_t<rdb_protocol_t>*, boost::shared_ptr<internal_disk_backed_queue_t>, auto_drainer_t::lock_t), boost::_bi::list4<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >, boost::_bi::value<auto_drainer_t::lock_t> > >::~bind_t() at bind.hpp:864\r\n       34: callable_action_instance_t<boost::_bi::bind_t<void, void (*)(std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > const&, btree_store_t<rdb_protocol_t>*, boost::shared_ptr<internal_disk_backed_queue_t>, auto_drainer_t::lock_t), boost::_bi::list4<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >, boost::_bi::value<auto_drainer_t::lock_t> > > >::~callable_action_instance_t() at callable_action.hpp:24\r\n       35: callable_action_instance_t<boost::_bi::bind_t<void, void (*)(std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > const&, btree_store_t<rdb_protocol_t>*, boost::shared_ptr<internal_disk_backed_queue_t>, auto_drainer_t::lock_t), boost::_bi::list4<boost::_bi::value<std::set<uuid_u, std::less<uuid_u>, std::allocator<uuid_u> > >, boost::_bi::value<btree_store_t<rdb_protocol_t>*>, boost::_bi::value<boost::shared_ptr<internal_disk_backed_queue_t> >, boost::_bi::value<auto_drainer_t::lock_t> > > >::~callable_action_instance_t() at callable_action.hpp:24\r\n       36: callable_action_wrapper_t::reset() at runtime_utils.cc:60\r\n       37: coro_t::run() at coroutines.cc:189\r\n```\r\n\r\nAs an aside, this seems easier to reproduce on tests involving sindexes."
  , issueCommentId = 22228659
  }