IssueComment
  { issueCommentUpdatedAt = 2016 (-04) (-20) 09 : 23 : 23 UTC
  , issueCommentUser =
      SimpleUser
        { simpleUserId = Id 1430058
        , simpleUserLogin = N "ntquyen"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/1430058?v=3"
        , simpleUserUrl = "https://api.github.com/users/ntquyen"
        , simpleUserType = OwnerUser
        }
  , issueCommentUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/comments/212344710"
  , issueCommentHtmlUrl =
      "https://github.com/rethinkdb/rethinkdb/issues/5456#issuecomment-212344710"
  , issueCommentCreatedAt = 2016 (-04) (-20) 09 : 23 : 23 UTC
  , issueCommentBody =
      "@danielmewes I've just upgraded my cluster from 2.2.5 to 2.2.6 but I still got error \r\n```\r\nRejected a connection from server 1f360f0b-a209-4e63-a43b-3dfdc629520a since one is open already.\r\n```\r\n\r\nHere how to reproduce it:\r\n\r\nMy cluster has only one instance, and I have some rethinkdb proxies connecting to it.\r\n\r\nrethinkdb container running outside kubernetes:\r\n```\r\n\"Cmd\": [\r\n      \"rethinkdb\",\r\n      \"-d\",\r\n      \"/data\",\r\n      \"--cache-size\",\r\n      \"2000\",\r\n      \"--bind\",\r\n      \"all\",\r\n      \"--canonical-address\",\r\n      \"10.9.8.2:29015\"\r\n],\r\n```\r\n\r\nEach rethinkdb proxy runs in a kubernetes pod with my app container and bind to `localhost` so that my app can connect to the cluster via `localhost:28015`\r\n\r\n```\r\n- command:\r\n    - rethinkdb\r\n    - proxy\r\n    - --join\r\n    - 10.9.8.2:29015\r\n```\r\n\r\nA weird thing I see from the proxies `log_file` is that all proxies have the same uuid (`15f81be4-d716-4242-be1e-fb9237bf706f`):\r\n\r\n**proxy 1 log_file:**\r\n```\r\n2016-04-20T07:39:04.036435371 0.490353s notice: Connected to server \"b183f782f348_6pb\" 1f360f0b-a209-4e63-a43b-3dfdc629520a\r\n2016-04-20T07:39:04.038912451 0.492829s notice: Listening for client driver connections on port 28015\r\n2016-04-20T07:39:04.038938250 0.492855s notice: Listening for administrative HTTP connections on port 8080\r\n2016-04-20T07:39:04.038939150 0.492856s notice: Listening on addresses: 127.0.0.1, ::1\r\n2016-04-20T07:39:04.038942450 0.492859s notice: To fully expose RethinkDB on the network, bind to all addresses by running rethinkdb with the `--bind all` command line option.\r\n2016-04-20T07:39:04.038944350 0.492861s notice: Proxy ready\r\n2016-04-20T07:39:04.038946250 0.492863s info: Rejected a connection from server proxy-2f59cfa0-4201-40c8-856b-18e2fcc82b81 since one is open already.\r\n2016-04-20T07:39:04.039361347 0.493278s info: Rejected a connection from server proxy-2f59cfa0-4201-40c8-856b-18e2fcc82b81 since one is open already.\r\n2016-04-20T07:39:04.039677744 0.493595s info: Rejected a connection from server proxy-2f59cfa0-4201-40c8-856b-18e2fcc82b81 since one is open already.\r\n2016-04-20T07:39:04.039996041 0.493913s info: Rejected a connection from server proxy-2f59cfa0-4201-40c8-856b-18e2fcc82b81 since one is open already.\r\n2016-04-20T07:39:04.040381638 0.494299s info: Rejected a connection from server proxy-2f59cfa0-4201-40c8-856b-18e2fcc82b81 since one is open already.\r\n2016-04-20T07:39:04.040647236 0.494564s info: Rejected a connection from server proxy-2f59cfa0-4201-40c8-856b-18e2fcc82b81 since one is open already.\r\n2016-04-20T07:39:04.041056033 0.494973s notice: Connected to proxy 15f81be4-d716-4242-be1e-fb9237bf706f\r\n```\r\n\r\n**proxy 2 log_file:**\r\n```\r\n2016-04-20T07:29:54.209393541 0.554126s notice: Listening for client driver connections on port 28015\r\n2016-04-20T07:29:54.209449040 0.554181s notice: Listening for administrative HTTP connections on port 8080\r\n2016-04-20T07:29:54.209453340 0.554185s notice: Listening on addresses: 127.0.0.1, ::1\r\n2016-04-20T07:29:54.209456640 0.554188s notice: To fully expose RethinkDB on the network, bind to all addresses by running rethinkdb with the `--bind all` command line option.\r\n2016-04-20T07:29:54.209460140 0.554192s notice: Proxy ready\r\n2016-04-20T07:29:54.213236508 0.557969s info: Rejected a connection from server proxy-cf8a3398-560c-4436-b803-dadbba0462e1 since one is open already.\r\n2016-04-20T07:29:54.214159700 0.558892s info: Rejected a connection from server proxy-cf8a3398-560c-4436-b803-dadbba0462e1 since one is open already.\r\n2016-04-20T07:29:54.215506388 0.560239s info: Rejected a connection from server proxy-cf8a3398-560c-4436-b803-dadbba0462e1 since one is open already.\r\n2016-04-20T07:29:54.216138282 0.560870s info: Rejected a connection from server proxy-cf8a3398-560c-4436-b803-dadbba0462e1 since one is open already.\r\n2016-04-20T07:29:54.216864676 0.561597s info: Rejected a connection from server proxy-cf8a3398-560c-4436-b803-dadbba0462e1 since one is open already.\r\n2016-04-20T07:29:54.217431171 0.562163s info: Rejected a connection from server proxy-cf8a3398-560c-4436-b803-dadbba0462e1 since one is open already.\r\n2016-04-20T07:29:54.219317855 0.564051s notice: Connected to proxy 15f81be4-d716-4242-be1e-fb9237bf706f\r\n2016-04-20T07:29:54.232933537 0.577666s notice: Connected to server \"b183f782f348_6pb\" 1f360f0b-a209-4e63-a43b-3dfdc629520a\r\n```\r\n\r\nas you said in this comment https://github.com/rethinkdb/rethinkdb/issues/4934#issuecomment-146987871, I'm still not sure why the proxies have the same uuid. If `15f81be4-d716-4242-be1e-fb9237bf706f` is the proxy id, then what is `proxy-cf8a3398-560c-4436-b803-dadbba0462e1`?\r\n\r\n> One possible source of issues could be that proxies right now appear to try connecting to each other.\r\nIf all of the proxies only bind to localhost, different proxies might try to establish connections to localhost to reach some of the other proxies. However there they won't find the expected other proxies, but will end up connecting to themselves of course.\r\n\r\nI think you don't need kubernetes, using docker container networking is enough to reproduce the case"
  , issueCommentId = 212344710
  }