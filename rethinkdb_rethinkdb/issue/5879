Issue
  { issueClosedAt = Nothing
  , issueUpdatedAt = 2016 (-07) (-08) 03 : 39 : 01 UTC
  , issueEventsUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5879/events"
  , issueHtmlUrl =
      Just "https://github.com/rethinkdb/rethinkdb/issues/5879"
  , issueClosedBy = Nothing
  , issueLabels =
      [ IssueLabel
          { labelColor = "0052cc"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/tp:ReQL_proposal"
          , labelName = "tp:ReQL_proposal"
          }
      ]
  , issueNumber = 5879
  , issueAssignee = Nothing
  , issueUser =
      SimpleUser
        { simpleUserId = Id 877936
        , simpleUserLogin = N "marshall007"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/877936?v=3"
        , simpleUserUrl = "https://api.github.com/users/marshall007"
        , simpleUserType = OwnerUser
        }
  , issueTitle = "Proposal: schema primitives in ReQL"
  , issuePullRequest = Nothing
  , issueUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5879"
  , issueCreatedAt = 2016 (-06) (-22) 19 : 34 : 37 UTC
  , issueBody =
      Just
        "I'd like to propose a set of utility functions for creating schema validators that I think would be useful in a variety of contexts.\r\n\r\n#### Goals\r\n\r\n1. Provide rich ReQL API for defining and executing object schemas.\r\n1. Meet needs of Horizon validation functions so they can be run in ReQL.\r\n1. Identify and support common validation operators.\r\n  - Long term I think we should err on the side of being feature-rich.\r\n1. Use as secondary index functions? (i.e. `indexCreate(..., r.schema(...))`)\r\n\r\n#### Possible Future Goals\r\n\r\n1. Assign schema to a table and enforce on all write operations.\r\n1. Explicit `schema` optarg to `insert`, `update`, etc.\r\n1. Use as document expiration functions from #5823 (i.e. expire when document becomes invalid).\r\n\r\n#### Questions\r\n\r\n- Should we instead rely on or at least support parsing some standard format like JSON Schema?\r\n- Do or will we ever need to worry about validating document relationships?\r\n\r\n#### Usage\r\n\r\n```js\r\nr.schema(<schema>)(<data>, <options>)\r\n```\r\n\r\n`r.schema(...)` returns a function that accepts two arguments, the context to evaluate the schema in and any options we might support. Executing the function returns an object containing the validation status and either the valid data or any validation errors that occurred. Possible options might include:\r\n\r\n- `terminate`: when `true` stops when first validation error is encountered. Otherwise errors for all fields are returned.\r\n- `convert`: automatically attempt to coerce values to the required type (i.e. `string <-> number/boolean/date`).\r\n\r\n#### Examples\r\n\r\nRough outline of what this might look like in practice:\r\n\r\n```js\r\nconst schema = r.schema({\r\n  code: r.string().min(3).max(9).upper(), // [A-Z\\W]{3,9}\r\n  date: r.date().min(r.time(2016, 6, 22, 'Z')).max(r.now()) // between 2016-06-22 and now\r\n  value: r.number()\r\n})\r\n\r\nschema(r.expr({ code: 'ABC', date: r.now(), value: 5 }))\r\n/* ->\r\n{\r\n  valid: true,\r\n  data: {\r\n    code: 'ABC',\r\n    date: Date('2016-06-22'),\r\n    value: 5\r\n  }\r\n}\r\n*/\r\n\r\nschema(r.expr({ code: 'AB', date: 'NOT_A_DATE', value: 5 }))\r\n/* ->\r\n{\r\n  valid: false,\r\n  data: {\r\n    value: 5\r\n  }\r\n  errors: {\r\n    code: { min: { required: 3, actual: 2 } },\r\n    date: { type: { required: 'DATE', actual: 'STRING' } }\r\n  }\r\n}\r\n*/\r\n```"
  , issueState = "open"
  , issueId = Id 161767026
  , issueComments = 2
  , issueMilestone =
      Just
        Milestone
          { milestoneCreator =
              SimpleUser
                { simpleUserId = Id 48436
                , simpleUserLogin = N "coffeemug"
                , simpleUserAvatarUrl =
                    "https://avatars.githubusercontent.com/u/48436?v=3"
                , simpleUserUrl = "https://api.github.com/users/coffeemug"
                , simpleUserType = OwnerUser
                }
          , milestoneDueOn = Nothing
          , milestoneOpenIssues = 268
          , milestoneNumber = 41
          , milestoneClosedIssues = 0
          , milestoneDescription =
              Just
                "Issues in this milestone will be revisited after each major release during the planning stage for the major release after it. They will be moved to a specific release milestone if chosen for that release."
          , milestoneTitle = "subsequent"
          , milestoneUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/milestones/41"
          , milestoneCreatedAt = 2013 (-06) (-30) 07 : 32 : 52 UTC
          , milestoneState = "open"
          }
  }