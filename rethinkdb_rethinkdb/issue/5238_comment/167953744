IssueComment
  { issueCommentUpdatedAt = 2015 (-12) (-30) 07 : 52 : 37 UTC
  , issueCommentUser =
      SimpleUser
        { simpleUserId = Id 552910
        , simpleUserLogin = N "Tryneus"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/552910?v=3"
        , simpleUserUrl = "https://api.github.com/users/Tryneus"
        , simpleUserType = OwnerUser
        }
  , issueCommentUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/comments/167953744"
  , issueCommentHtmlUrl =
      "https://github.com/rethinkdb/rethinkdb/issues/5238#issuecomment-167953744"
  , issueCommentCreatedAt = 2015 (-12) (-30) 07 : 52 : 37 UTC
  , issueCommentBody =
      "@danielmewes: Just ran the test against `v2.2.1` and saw this crash:\r\n\r\n```\r\n#0  format_log_message (m=..., for_console=false)\r\n    at ../src/clustering/administration/logs/log_writer.cc:100\r\n#1  fallback_log_writer_t::write (this=0x41e39e0, msg=..., error_out=0x7f5365ff41c0)\r\n    at ../src/clustering/administration/logs/log_writer.cc:367\r\n#2  fallback_log_writer_t::initiate_write (this=0x41e39e0, level=log_level_error,\r\n    message=\r\n    \"Assertion failed: [right.unbounded || left <= right.key()] left_key(22)=Nc0825\", '0' <repeats 11 times>, \"#586, right_key(9)=Nc0813\\023\\235\", <incomplete sequence \\346>)\r\n    at ../src/clustering/administration/logs/log_writer.cc:439\r\n#3  vlog_internal(const char *, int, log_level_t, const char *, typedef __va_list_tag __va_list_tag *) (src_file=0x2e1bf43 \"../src/errors.cc\", src_line=76, level=log_level_error,\r\n    format=0x2c13058 \"Assertion failed: [right.unbounded || left <= right.key()] left_key(%d)=%.*s, right_key(%d)=%.*s\", args=0x7f5365ff42d8) at ../src/clustering/administration/logs/log_writer.cc:622\r\n#4  report_fatal_error (file=0x2c13018 \"../src/btree/keys.cc\", line=116,\r\n    msg=0x2c13058 \"Assertion failed: [right.unbounded || left <= right.key()] left_key(%d)=%.*s, right_key(%d)=%.*s\") at ../src/errors.cc:76\r\n#5  key_range_t::init (this=0x7f5365ff47c0, lm=key_range_t::closed, l=0x7f538849da68,\r\n    rm=key_range_t::open, r=0x7f5365ff4a00) at ../src/btree/keys.cc:112\r\n#6  key_range_t::key_range_t (this=0x7f5365ff47c0, lm=key_range_t::closed, l=...,\r\n    rm=key_range_t::open, r=...) at ../src/btree/keys.cc:63\r\n#7  ql::rget_response_reader_t::truncate_and_get_active_state (this=0x7f538849d800)\r\n    at ../src/rdb_protocol/datum_stream.cc:482\r\n#8  ql::lazy_datum_stream_t::truncate_and_get_active_state (this=0x7f5365ec5a90)\r\n    at ../src/rdb_protocol/datum_stream.hpp:770\r\n#9 ql::changefeed::splice_stream_t::update_ranges (this=0x7f5365dbc780)\r\n    at ../src/rdb_protocol/changefeed.cc:2625\r\n#10 ql::changefeed::splice_stream_t::next_stream_batch (this=0x7f5365dbc780,\r\n    env=0x7f5365ff58c0, bs=...) at ../src/rdb_protocol/changefeed.cc:2552\r\n#11 ql::changefeed::stream_t<ql::changefeed::range_sub_t>::next_raw_batch (\r\n    this=0x7f5365dbc780, env=0x7f5365ff58c0, bs=...) at ../src/rdb_protocol/changefeed.cc:1250\r\n#12 ql::eager_datum_stream_t::next_grouped_batch (this=0x7f5365dbc780,\r\n    env=0x7f5365ff58c0, bs=..., out=0x7f5365ff5760) at ../src/rdb_protocol/datum_stream.cc:1255\r\n#13 ql::eager_datum_stream_t::next_batch_impl (this=0x7f5365dbc780, env=0x7f5365ff58c0,\r\n    bs=...) at ../src/rdb_protocol/datum_stream.cc:1292\r\n#14 ql::datum_stream_t::next_batch (this=0x7f5365dbc780, env=0x7f5365ff58c0,\r\n    batchspec=...) at ../src/rdb_protocol/datum_stream.cc:1212\r\n#15 ql::query_cache_t::ref_t::serve (this=0x7f53654ecb00, env=0x7f5365ff58c0,\r\n    res=0x7f5365ff5ea0) at ../src/rdb_protocol/query_cache.cc:304\r\n#16 ql::query_cache_t::ref_t::fill_response (this=0x7f53654ecb00, res=0x7f5365ff5ea0)\r\n    at ../src/rdb_protocol/query_cache.cc:202\r\n#17 rdb_query_server_t::run_query (this=0x7f5377075f00, query_params=0x7f53636a6060,\r\n    response_out=0x7f5365ff5ea0, interruptor=0x7f5365ff5cb0) at ../src/rdb_protocol/query_server.cc:48\r\n```\r\n\r\nThis appears to be two problems:\r\n * An unexpected key range is generated\r\n * An assertion message is unprintable for our logger\r\n\r\nNeither of these are the same as the original problem, but I'm not convinced this will happen in `v2.2.x` because the first problem is in `ql::rget_response_reader_t::truncate_and_get_active_state`, which appears to have been rewritten.\r\n\r\nI have a core file available on `newton` at `~grey/issue_5238/`."
  , issueCommentId = 167953744
  }