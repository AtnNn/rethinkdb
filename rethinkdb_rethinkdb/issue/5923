Issue
  { issueClosedAt = Just 2016 (-08) (-05) 23 : 26 : 10 UTC
  , issueUpdatedAt = 2016 (-08) (-30) 01 : 52 : 26 UTC
  , issueEventsUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5923/events"
  , issueHtmlUrl =
      Just "https://github.com/rethinkdb/rethinkdb/issues/5923"
  , issueClosedBy = Nothing
  , issueLabels =
      [ IssueLabel
          { labelColor = "e102d8"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/tp:bug"
          , labelName = "tp:bug"
          }
      ]
  , issueNumber = 5923
  , issueAssignee =
      Just
        SimpleUser
          { simpleUserId = Id 505365
          , simpleUserLogin = N "danielmewes"
          , simpleUserAvatarUrl =
              "https://avatars.githubusercontent.com/u/505365?v=3"
          , simpleUserUrl = "https://api.github.com/users/danielmewes"
          , simpleUserType = OwnerUser
          }
  , issueUser =
      SimpleUser
        { simpleUserId = Id 7917
        , simpleUserLogin = N "bsharpe"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/7917?v=3"
        , simpleUserUrl = "https://api.github.com/users/bsharpe"
        , simpleUserType = OwnerUser
        }
  , issueTitle = "Sharding with Multi-index causes severe file bloat"
  , issuePullRequest = Nothing
  , issueUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5923"
  , issueCreatedAt = 2016 (-07) (-07) 14 : 11 : 45 UTC
  , issueBody =
      Just
        "We have a table in our DB that has 20MM rows in it.   Each row is a small bit of data and an array of integers representing dates.   That array can be 10 to 1600 entries (average 30).  The base data is approximately 10G. The primary key is 56-bytes (sha3-224bit).\r\nArray data looks like: `[1443398400, 1443484800, 1443571200, 1443657600]`\r\n\r\nWe multi-index on that array to be able to quickly find items that apply to a specific date for a specific account quickly.\r\n\r\nThe index is defined like this: (Ruby syntax)\r\n```\r\n->(d){ d['dates'].map{|e| [d['account_id'], e]} }, multi: true\r\n```\r\n\r\nNote: We tried a compound index with account_id and two dates (start & end) -- but the secondary indexes don't filter as intuitively as imagined with dates involved. This required us to `filter` results after using the index which is 10x slower than the mutli-index approach.\r\n\r\nWe have 2 nodes (db-1 & db-2), which according to the admin panel have 9.5MM rows each.\r\nThe table is set to 2 shards/2 replicas.\r\n- on db-1 this table takes up: 242G (1 shard + 1 replica)\r\n- on db-2 this table takes up: 241G (1 shard + 1 replica)\r\n\r\nWe were adding a 3rd node and resharding this table to be (3/3) -- the data on db-3 exceeded 1.3T\r\n\r\nWe've had trouble with this table before...  \r\nHere's the part where we believe there's a bug:\r\n```\r\nDeleting and rebuilding just this one index can reduce the space by as much as 50%.\r\n```\r\n\r\nThis is seriously impacting our ability to grow (we can't add a 3rd node, for example).   We have tables with 40MM entries where the rows are much larger but the file takes up less space.\r\n\r\nOur Math:\r\n```\r\n(56bytes for ID + ~20bytes for each date in the index) \r\n * 30 dates(average per row) \r\n * 20MM rows = ~45G\r\n\r\nour db-3 server was needing 31x that amount of space for this one table.\r\n```\r\n\r\nFYI:  \r\n  - RethinkDB 2.3.4 from your APT repos on Ubuntu 14.04.1 w/ no virtualization using XFS\r\n  - Servers have 256G RAM, 24 cores, 1.4T storage"
  , issueState = "closed"
  , issueId = Id 164318525
  , issueComments = 22
  , issueMilestone =
      Just
        Milestone
          { milestoneCreator =
              SimpleUser
                { simpleUserId = Id 505365
                , simpleUserLogin = N "danielmewes"
                , simpleUserAvatarUrl =
                    "https://avatars.githubusercontent.com/u/505365?v=3"
                , simpleUserUrl = "https://api.github.com/users/danielmewes"
                , simpleUserType = OwnerUser
                }
          , milestoneDueOn = Just 2016 (-08) (-04) 07 : 00 : 00 UTC
          , milestoneOpenIssues = 0
          , milestoneNumber = 126
          , milestoneClosedIssues = 39
          , milestoneDescription = Just ""
          , milestoneTitle = "2.3.5"
          , milestoneUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/milestones/126"
          , milestoneCreatedAt = 2016 (-07) (-28) 21 : 38 : 16 UTC
          , milestoneState = "closed"
          }
  }