Issue
  { issueClosedAt = Just 2015 (-12) (-01) 07 : 02 : 40 UTC
  , issueUpdatedAt = 2015 (-12) (-15) 22 : 27 : 03 UTC
  , issueEventsUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5099/events"
  , issueHtmlUrl =
      Just "https://github.com/rethinkdb/rethinkdb/issues/5099"
  , issueClosedBy = Nothing
  , issueLabels =
      [ IssueLabel
          { labelColor = "e10c02"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/pr:high"
          , labelName = "pr:high"
          }
      , IssueLabel
          { labelColor = "444444"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/tp:performance"
          , labelName = "tp:performance"
          }
      ]
  , issueNumber = 5099
  , issueAssignee = Nothing
  , issueUser =
      SimpleUser
        { simpleUserId = Id 314077
        , simpleUserLogin = N "avimar"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/314077?v=3"
        , simpleUserUrl = "https://api.github.com/users/avimar"
        , simpleUserType = OwnerUser
        }
  , issueTitle = "2.2 indexed query slow-down!"
  , issuePullRequest = Nothing
  , issueUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5099"
  , issueCreatedAt = 2015 (-11) (-16) 06 : 54 : 54 UTC
  , issueBody =
      Just
        "I upgraded to 2.2 for the expected increased index performance, but it seems orders of magnitude slower, even once the indexes have been rebuilt (maybe they failed?)\r\n\r\nWhat used to take 2-4 seconds now takes 20-60, or even times out.\r\n\r\nMy query is built like so:\r\n\r\n```\r\n\tvar pluckVariables=['children','uuid','epoch','from', 'to', 'countryCode', 'countryCodeCaller','accountcode','billsec','rate','charge',\r\n\t\t\t'variables_end_epoch','variables_hangup_cause','variables_waitsec','variables_answersec','costs_carrier','costs_routeNumber',\r\n\t\t\t'variables_sip_hangup_disposition','charge_increment','charge_minimum', 'variables_callsource','pdd','ring'];\r\n\tvar start = (req.params.start) ? r.ISO8601(req.params.start) : r.now().sub(0.5*60*60);//default to .5hr if not specified start time\r\n\tvar query = r.table('cdrs');//from which table\r\n\r\n\tquery = query.between(start.sub(1.5*60*60),r.maxval,{index:'epoch'})//use date secondary index, but get calls even 1.5hours early, to ensure we get ALL calls.\r\n\tquery = query.orderBy({index: 'epoch'});//must be done here, since it can only be after a between and not after a filter.\r\n\tquery = query.filter({leg: 'a'})//we want A legs with their children\r\n\tquery = query.filter(r.row('variables_end_epoch').gt(start));//but make sure it ENDED after our start.\r\n\tquery = query.limit(100);//add limit before we start looking up children.\r\n\tquery = query.pluck(pluckVariables);//ensure to pluck specified variables\r\n\tquery = query.merge(function(row){\r\n  \t\treturn {children: r.db('freeswitch').table('cdrs').getAll(row('uuid'),{index:'bridge_uuid'})\r\n  \t\t\t.pluck(pluckVariables)//only what we need\r\n\t\t\t.orderBy(r.asc('epoch'))\r\n  \t\t\t}\r\n\t\t});\r\n```\r\nBefore moving the query.orderby to the top and having it use the index, it was very slow. But once I moved it there and the limit, it seemed to always only take 2-4 seconds.\r\nIt gets approx 4kb call records from freeswitch via the index, checks the leg and end time, but only gets 100. Then it merges in child rows, also via an index. I expected these lookups and merges to have sped up in the new release.\r\n\r\n\r\nIf it makes any difference, the query is run over tinc to access the cluster.\r\nHmm, it says this query took 18seconds end-to-end, but I don't see it in the profiler...\r\nThe only thing that changed was a proxy on my ubuntu 10.04 sever which doesn't have a package for the new version, but it was over tinc anyway.\r\n\r\nIdeas?\r\n\r\n\r\n```\r\n[\r\n    {\r\n        \"description\": \"Evaluating merge.\",\r\n        \"duration(ms)\": 2.459199,\r\n        \"sub_tasks\": [\r\n            {\r\n                \"description\": \"Evaluating pluck.\",\r\n                \"duration(ms)\": 1.737721,\r\n                \"sub_tasks\": [\r\n                    {\r\n                        \"description\": \"Evaluating limit.\",\r\n                        \"duration(ms)\": 1.477291,\r\n                        \"sub_tasks\": [\r\n                            {\r\n                                \"description\": \"Evaluating filter.\",\r\n                                \"duration(ms)\": 1.444711,\r\n                                \"sub_tasks\": [\r\n                                    {\r\n                                        \"description\": \"Evaluating filter.\",\r\n                                        \"duration(ms)\": 1.412716,\r\n                                        \"sub_tasks\": [\r\n                                            {\r\n                                                \"description\": \"Evaluating orderby.\",\r\n                                                \"duration(ms)\": 1.197878,\r\n                                                \"sub_tasks\": [\r\n                                                    {\r\n                                                        \"description\": \"Evaluating between.\",\r\n                                                        \"duration(ms)\": 1.150246,\r\n                                                        \"sub_tasks\": [\r\n                                                            {\r\n                                                                \"description\": \"Evaluating table.\",\r\n                                                                \"duration(ms)\": 0.165142,\r\n                                                                \"sub_tasks\": [\r\n                                                                    {\r\n                                                                        \"description\": \"Evaluating datum.\",\r\n                                                                        \"duration(ms)\": 0.007418,\r\n                                                                        \"sub_tasks\": []\r\n                                                                    },\r\n                                                                    {\r\n                                                                        \"description\": \"Evaluating datum.\",\r\n                                                                        \"duration(ms)\": 0.003337,\r\n                                                                        \"sub_tasks\": []\r\n                                                                    },\r\n                                                                    {\r\n                                                                        \"description\": \"Evaluating db.\",\r\n                                                                        \"duration(ms)\": 0.048757,\r\n                                                                        \"sub_tasks\": [\r\n                                                                            {\r\n                                                                                \"description\": \"Evaluating datum.\",\r\n                                                                                \"duration(ms)\": 0.003472,\r\n                                                                                \"sub_tasks\": []\r\n                                                                            }\r\n                                                                        ]\r\n                                                                    }\r\n                                                                ]\r\n                                                            },\r\n                                                            {\r\n                                                                \"description\": \"Evaluating SUB.\",\r\n                                                                \"duration(ms)\": 0.481853,\r\n                                                                \"sub_tasks\": [\r\n                                                                    {\r\n                                                                        \"description\": \"Evaluating iso8601.\",\r\n                                                                        \"duration(ms)\": 0.334493,\r\n                                                                        \"sub_tasks\": [\r\n                                                                            {\r\n                                                                                \"description\": \"Evaluating datum.\",\r\n                                                                                \"duration(ms)\": 0.004245,\r\n                                                                                \"sub_tasks\": []\r\n                                                                            }\r\n                                                                        ]\r\n                                                                    },\r\n                                                                    {\r\n                                                                        \"description\": \"Evaluating datum.\",\r\n                                                                        \"duration(ms)\": 0.00354,\r\n                                                                        \"sub_tasks\": []\r\n                                                                    }\r\n                                                                ]\r\n                                                            },\r\n                                                            {\r\n                                                                \"description\": \"Evaluating ADD.\",\r\n                                                                \"duration(ms)\": 0.391177,\r\n                                                                \"sub_tasks\": [\r\n                                                                    {\r\n                                                                        \"description\": \"Evaluating iso8601.\",\r\n                                                                        \"duration(ms)\": 0.254842,\r\n                                                                        \"sub_tasks\": [\r\n                                                                            {\r\n                                                                                \"description\": \"Evaluating datum.\",\r\n                                                                                \"duration(ms)\": 0.003383,\r\n                                                                                \"sub_tasks\": []\r\n                                                                            }\r\n                                                                        ]\r\n                                                                    },\r\n                                                                    {\r\n                                                                        \"description\": \"Evaluating datum.\",\r\n                                                                        \"duration(ms)\": 0.00378,\r\n                                                                        \"sub_tasks\": []\r\n                                                                    }\r\n                                                                ]\r\n                                                            },\r\n                                                            {\r\n                                                                \"description\": \"Evaluating datum.\",\r\n                                                                \"duration(ms)\": 0.003818,\r\n                                                                \"sub_tasks\": []\r\n                                                            }\r\n                                                        ]\r\n                                                    },\r\n                                                    {\r\n                                                        \"description\": \"Evaluating datum.\",\r\n                                                        \"duration(ms)\": 0.003368,\r\n                                                        \"sub_tasks\": []\r\n                                                    }\r\n                                                ]\r\n                                            },\r\n                                            {\r\n                                                \"description\": \"Evaluating make_obj.\",\r\n                                                \"duration(ms)\": 0.03417,\r\n                                                \"sub_tasks\": [\r\n                                                    {\r\n                                                        \"description\": \"Evaluating elements in make_obj.\",\r\n                                                        \"mean_duration(ms)\": 0.004095,\r\n                                                        \"n_samples\": 1\r\n                                                    }\r\n                                                ]\r\n                                            }\r\n                                        ]\r\n                                    },\r\n                                    {\r\n                                        \"description\": \"Evaluating func.\",\r\n                                        \"duration(ms)\": 0.00561,\r\n                                        \"sub_tasks\": []\r\n                                    }\r\n                                ]\r\n                            },\r\n                            {\r\n                                \"description\": \"Evaluating datum.\",\r\n                                \"duration(ms)\": 0.00363,\r\n                                \"sub_tasks\": []\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        \"description\": \"Slicing eagerly.\",\r\n        \"mean_duration(ms)\": 1987.081736,\r\n        \"n_samples\": 1\r\n    },\r\n    {\r\n        \"description\": \"Evaluating pluck.\",\r\n        \"duration(ms)\": 0.720473,\r\n        \"sub_tasks\": [\r\n            {\r\n                \"description\": \"Evaluating var.\",\r\n                \"duration(ms)\": 0.002089,\r\n                \"sub_tasks\": []\r\n            },\r\n            {\r\n                \"description\": \"Evaluating make_array.\",\r\n                \"duration(ms)\": 0.190635,\r\n                \"sub_tasks\": [\r\n                    {\r\n                        \"description\": \"Evaluating datum.\",\r\n                        \"duration(ms)\": 0.001928,\r\n                        \"sub_tasks\": []\r\n                    },\r\n                    {\r\n                        \"description\": \"Evaluating elements in make_array.\",\r\n                        \"mean_duration(ms)\": 0.001406,\r\n                        \"n_samples\": 22\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        \"description\": \"Evaluating merge.\",\r\n        \"duration(ms)\": 58.978607,\r\n        \"sub_tasks\": [\r\n            {\r\n                \"description\": \"Evaluating var.\",\r\n                \"duration(ms)\": 0.001627,\r\n                \"sub_tasks\": []\r\n            },\r\n            {\r\n                \"description\": \"Evaluating func.\",\r\n                \"duration(ms)\": 0.012525,\r\n                \"sub_tasks\": []\r\n            },\r\n            {\r\n                \"description\": \"Evaluating make_obj.\",\r\n                \"duration(ms)\": 58.730702,\r\n                \"sub_tasks\": [\r\n                    {\r\n                        \"description\": \"Evaluating elements in make_obj.\",\r\n                        \"mean_duration(ms)\": 58.684626,\r\n                        \"n_samples\": 1\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n]\r\n\r\n```"
  , issueState = "closed"
  , issueId = Id 117064758
  , issueComments = 14
  , issueMilestone =
      Just
        Milestone
          { milestoneCreator =
              SimpleUser
                { simpleUserId = Id 706854
                , simpleUserLogin = N "AtnNn"
                , simpleUserAvatarUrl =
                    "https://avatars.githubusercontent.com/u/706854?v=3"
                , simpleUserUrl = "https://api.github.com/users/AtnNn"
                , simpleUserType = OwnerUser
                }
          , milestoneDueOn = Nothing
          , milestoneOpenIssues = 0
          , milestoneNumber = 27
          , milestoneClosedIssues = 127
          , milestoneDescription =
              Just
                "These issues are not reproducible or happen in platforms or configurations that are not supported."
          , milestoneTitle = "worksforme"
          , milestoneUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/milestones/27"
          , milestoneCreatedAt = 2013 (-04) (-08) 21 : 57 : 50 UTC
          , milestoneState = "closed"
          }
  }