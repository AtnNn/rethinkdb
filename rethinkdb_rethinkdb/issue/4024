Issue
  { issueClosedAt = Just 2015 (-06) (-05) 03 : 34 : 27 UTC
  , issueUpdatedAt = 2015 (-06) (-05) 03 : 35 : 12 UTC
  , issueEventsUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/4024/events"
  , issueHtmlUrl =
      Just "https://github.com/rethinkdb/rethinkdb/issues/4024"
  , issueClosedBy = Nothing
  , issueLabels =
      [ IssueLabel
          { labelColor = "e10c02"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/pr:high"
          , labelName = "pr:high"
          }
      , IssueLabel
          { labelColor = "e102d8"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/tp:bug"
          , labelName = "tp:bug"
          }
      ]
  , issueNumber = 4024
  , issueAssignee =
      Just
        SimpleUser
          { simpleUserId = Id 505365
          , simpleUserLogin = N "danielmewes"
          , simpleUserAvatarUrl =
              "https://avatars.githubusercontent.com/u/505365?v=3"
          , simpleUserUrl = "https://api.github.com/users/danielmewes"
          , simpleUserType = OwnerUser
          }
  , issueUser =
      SimpleUser
        { simpleUserId = Id 563469
        , simpleUserLogin = N "niieani"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/563469?v=3"
        , simpleUserUrl = "https://api.github.com/users/niieani"
        , simpleUserType = OwnerUser
        }
  , issueTitle =
      "Strange behaviour with queries using recursive functions"
  , issuePullRequest = Nothing
  , issueUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/4024"
  , issueCreatedAt = 2015 (-04) (-07) 23 : 14 : 52 UTC
  , issueBody =
      Just
        "Hello,\n\nSince RethinkDB doesn't support recursive queries natively yet (https://github.com/rethinkdb/rethinkdb/issues/2751), I've developed this workaround:\n\n``` javascript\nvar howManyRecursions = 3;\n\nvar recursiveJoin = function(bubble, count) {\n  if (count <= 0)\n    return bubble;\n  return r.branch(\n    // IF\n    bubble.hasFields('components'),\n    // THEN\n    bubble.merge(\n      r.object(\n        'components', bubble.getField('components')\n        .eqJoin(function(t){return t}, r.table(\"bubbles\"))\n        .zip().map(function(innerBubble){ return recursiveJoin(innerBubble, count-1) })\n      )\n    ),\n    // ELSE\n    bubble\n  )\n};\n\nr.table('bubbles')\n  .get('79b139b3-789a-f39a-5406-b5f2a563db0f').merge(\n    r.object(\n      'components', r.row('components')\n      .eqJoin(function(t){return t}, r.table(\"bubbles\"))\n      .zip().map(function(innerBubble){ return recursiveJoin(innerBubble, howManyRecursions) })\n    ));\n```\n\nThis works rather well with the official JS client as long as the number of recursions is small (something like 15 recursions takes 50ms on my computer), but when I do 150, RethinkDb's process stops responding or receiving connections again and needs to be restarted.\n\nIf I understand it correctly, in the above case the function is not reused by the server, but actually repeated by the client as many times as the recursion happens (calculated locally).\n\nSo I've tried reimplementing the same concept using server-side concepts, like this:\n\n``` javascript\nvar recurringFunction = function(count) {\n  return r.branch(\n    // IF\n    r.expr(count).gt(4),\n    // THEN\n    recurringFunction(r.expr(count).sub(1)),\n    // ELSE\n    r.expr(count)\n  );\n};\n\nr.json('[1,2,3]').map(function(item){\n  return recurringFunction(6);\n})\n```\n\nBut I get an error: \n\n```\nJavaScript error:\nRangeError: Maximum call stack size exceeded.\n```\n\nAny ideas why this is happening?\n\nIf you want to test the first implementation, create here's a sample table (`bubbles`) with level 2 join recursion:\n\n``` json\n[\n  {\n    \"components\": [\n      \"44ecf62e-801d-4215-b5d1-f9e229865954\",\n      \"fcf22d57-f86f-dbe3-5638-d60fe6a7aef7\",\n      \"31cba1e8-bcda-c755-288c-271c2f9afa67\"\n    ],\n    \"id\": \"79b139b3-789a-f39a-5406-b5f2a563db0f\"\n  },\n  {\n    \"id\": \"cada4674-cc8a-457e-ba99-b3aefb417fb5\",\n    \"value\": \"inner1\"\n  },\n  {\n    \"components\": [\n      \"cada4674-cc8a-457e-ba99-b3aefb417fb5\",\n      \"7c482d67-31b6-26f5-0f3b-6ffc7704697f\"\n    ],\n    \"id\": \"31cba1e8-bcda-c755-288c-271c2f9afa67\"\n  },\n  {\n    \"id\": \"44ecf62e-801d-4215-b5d1-f9e229865954\",\n    \"value\": \"test2\"\n  },\n  {\n    \"id\": \"fcf22d57-f86f-dbe3-5638-d60fe6a7aef7\",\n    \"value\": \"test1\"\n  },\n  {\n    \"id\": \"7c482d67-31b6-26f5-0f3b-6ffc7704697f\",\n    \"value\": \"inner2\"\n  }\n]\n```\n"
  , issueState = "closed"
  , issueId = Id 67010542
  , issueComments = 13
  , issueMilestone =
      Just
        Milestone
          { milestoneCreator =
              SimpleUser
                { simpleUserId = Id 706854
                , simpleUserLogin = N "AtnNn"
                , simpleUserAvatarUrl =
                    "https://avatars.githubusercontent.com/u/706854?v=3"
                , simpleUserUrl = "https://api.github.com/users/AtnNn"
                , simpleUserType = OwnerUser
                }
          , milestoneDueOn = Nothing
          , milestoneOpenIssues = 1
          , milestoneNumber = 17
          , milestoneClosedIssues = 595
          , milestoneDescription =
              Just
                "The scope of this issue is covered by another issue. The closing comment should link to the other issue."
          , milestoneTitle = "duplicate"
          , milestoneUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/milestones/17"
          , milestoneCreatedAt = 2013 (-03) (-29) 20 : 23 : 12 UTC
          , milestoneState = "closed"
          }
  }