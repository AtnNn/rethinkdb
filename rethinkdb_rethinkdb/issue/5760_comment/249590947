IssueComment
  { issueCommentUpdatedAt = 2016 (-09) (-26) 14 : 44 : 35 UTC
  , issueCommentUser =
      SimpleUser
        { simpleUserId = Id 372365
        , simpleUserLogin = N "analytik"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/372365?v=3"
        , simpleUserUrl = "https://api.github.com/users/analytik"
        , simpleUserType = OwnerUser
        }
  , issueCommentUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/comments/249590947"
  , issueCommentHtmlUrl =
      "https://github.com/rethinkdb/rethinkdb/issues/5760#issuecomment-249590947"
  , issueCommentCreatedAt = 2016 (-09) (-26) 14 : 44 : 35 UTC
  , issueCommentBody =
      "We hit this error today too, our max_map_count is at the default 65530. The server was using about 23GB of RAM - the usual level is 8-12GB, but it's been up to 40GB too, so it's not unusual.\r\n\r\nThere was probably a 150-350 backfills running at the time.\r\n\r\n```\r\nMon Sep 26 10:50:01 UTC 2016 Starting RethinkDB db3 rethinkdb3-ucmwe on 10.244.43.21 (rethinkdb3-ucmwe)\r\nRunning rethinkdb 2.3.5~0jessie (GCC 4.9.2)...\r\nRunning on Linux 4.6.3-coreos x86_64\r\nLoading data from directory /data/rethinkdb_data\r\nListening for intracluster connections on port 29015\r\nwarn: We were unable to connect to the following peers, or the --join address does not match the peer's canonical address: rethinkdb2:29015, rethinkdb4:29015, rethinkdb5:29015\r\nListening for client driver connections on port 28015\r\nListening for administrative HTTP connections on port 8080\r\nListening on cluster addresses: 127.0.0.1, 10.244.43.21, ::1, fe80::42:aff:fef4:2b15%628\r\nListening on driver addresses: 127.0.0.1, 10.244.43.21, ::1, fe80::42:aff:fef4:2b15%628\r\nListening on http addresses: 127.0.0.1, 10.244.43.21, ::1, fe80::42:aff:fef4:2b15%628\r\nServer ready, \"rethinkdb3_prod\" 2bbdcc9c-5d4a-43cb-a467-ec35d1b0302e\r\nConnected to server \"rethinkdb1_prod\" 45a95201-2a43-41b8-a7aa-b690e7ed9402\r\nConnected to server \"rethinkdb5_prod\" 994c06ed-54dc-43d1-b5d3-d0df70fd36b1\r\nConnected to server \"rethinkdb4_prod\" ccc52bc6-fb06-476b-9944-2ce8b2d3cc59\r\nConnected to proxy proxy-1cd0fdb0-3158-490d-a412-0779f1a4a682\r\nConnected to proxy proxy-256f53b5-b5be-40b9-804b-6e5a0212d1d2\r\nConnected to proxy proxy-80efbcc1-70a4-45c6-b5bc-7522fcfcfef3\r\nConnected to proxy proxy-92a19518-2484-4f5c-b967-07d2106c2a7f\r\nConnected to proxy proxy-2c8f6ee4-7a09-40e7-8cdd-ecd856f26ad5\r\nDisconnected from proxy proxy-92a19518-2484-4f5c-b967-07d2106c2a7f\r\nConnected to proxy proxy-0fbe4f68-1cde-4cfb-b578-e9df0e9ad632\r\nDisconnected from proxy proxy-2c8f6ee4-7a09-40e7-8cdd-ecd856f26ad5\r\nConnected to proxy proxy-5bf2ac84-96e2-407f-9583-667c98295538\r\nDisconnected from server \"rethinkdb4_prod\" ccc52bc6-fb06-476b-9944-2ce8b2d3cc59\r\nDisconnected from proxy proxy-0fbe4f68-1cde-4cfb-b578-e9df0e9ad632\r\nDisconnected from server \"rethinkdb5_prod\" 994c06ed-54dc-43d1-b5d3-d0df70fd36b1\r\nDisconnected from server \"rethinkdb1_prod\" 45a95201-2a43-41b8-a7aa-b690e7ed9402\r\nDisconnected from proxy proxy-256f53b5-b5be-40b9-804b-6e5a0212d1d2\r\nDisconnected from proxy proxy-5bf2ac84-96e2-407f-9583-667c98295538\r\nDisconnected from proxy proxy-1cd0fdb0-3158-490d-a412-0779f1a4a682\r\nDisconnected from proxy proxy-80efbcc1-70a4-45c6-b5bc-7522fcfcfef3\r\nConnected to server \"rethinkdb5_prod\" 994c06ed-54dc-43d1-b5d3-d0df70fd36b1\r\nConnected to proxy proxy-0fbe4f68-1cde-4cfb-b578-e9df0e9ad632\r\nConnected to server \"rethinkdb4_prod\" ccc52bc6-fb06-476b-9944-2ce8b2d3cc59\r\nConnected to proxy proxy-80efbcc1-70a4-45c6-b5bc-7522fcfcfef3\r\nConnected to proxy proxy-1cd0fdb0-3158-490d-a412-0779f1a4a682\r\nConnected to proxy proxy-5bf2ac84-96e2-407f-9583-667c98295538\r\nConnected to proxy proxy-256f53b5-b5be-40b9-804b-6e5a0212d1d2\r\nConnected to server \"rethinkdb1_prod\" 45a95201-2a43-41b8-a7aa-b690e7ed9402\r\nDisconnected from proxy proxy-80efbcc1-70a4-45c6-b5bc-7522fcfcfef3\r\nDisconnected from proxy proxy-5bf2ac84-96e2-407f-9583-667c98295538\r\nDisconnected from proxy proxy-1cd0fdb0-3158-490d-a412-0779f1a4a682\r\nDisconnected from proxy proxy-256f53b5-b5be-40b9-804b-6e5a0212d1d2\r\nDisconnected from proxy proxy-0fbe4f68-1cde-4cfb-b578-e9df0e9ad632\r\nVersion: rethinkdb 2.3.5~0jessie (GCC 4.9.2)\r\nerror: Error in src/arch/runtime/context_switching.cc at line 168:\r\nerror: Failed to (un-)protect a coroutine stack (`mprotect` failed with `ENOMEM`). Try increasing the value of `/proc/sys/vm/max_map_count`.\r\nerror: Backtrace:\r\nVersion: rethinkdb 2.3.5~0jessie (GCC 4.9.2)\r\nerror: Error in src/arch/runtime/context_switching.cc at line 168:\r\nerror: Failed to (un-)protect a coroutine stack (`mprotect` failed with `ENOMEM`). Try increasing the value of `/proc/sys/vm/max_map_count`.\r\nerror: Backtrace:\r\nVersion: rethinkdb 2.3.5~0jessie (GCC 4.9.2)\r\nerror: Error in src/arch/runtime/context_switching.cc at line 168:\r\nerror: Failed to (un-)protect a coroutine stack (`mprotect` failed with `ENOMEM`). Try increasing the value of `/proc/sys/vm/max_map_count`.\r\nerror: Backtrace:\r\nVersion: rethinkdb 2.3.5~0jessie (GCC 4.9.2)\r\nerror: Error in src/arch/runtime/context_switching.cc at line 168:\r\nVersion: rethinkdb 2.3.5~0jessie (GCC 4.9.2)\r\nerror: Failed to (un-)protect a coroutine stack (`mprotect` failed with `ENOMEM`). Try increasing the value of `/proc/sys/vm/max_map_count`.\r\nerror: Backtrace:\r\nerror: Error in src/arch/runtime/context_switching.cc at line 168:\r\nerror: Failed to (un-)protect a coroutine stack (`mprotect` failed with `ENOMEM`). Try increasing the value of `/proc/sys/vm/max_map_count`.\r\nVersion: rethinkdb 2.3.5~0jessie (GCC 4.9.2)\r\nerror: Error in src/arch/runtime/context_switching.cc at line 168:\r\nerror: Failed to (un-)protect a coroutine stack (`mprotect` failed with `ENOMEM`). Try increasing the value of `/proc/sys/vm/max_map_count`.\r\nerror: Backtrace:\r\nerror: Backtrace:\r\nerror: Mon Sep 26 11:30:04 2016\r\n\r\n       1 [0xae7500]: backtrace_t::backtrace_t() at ??:?\r\n       2 [0xae7879]: format_backtrace(bool) at ??:?\r\n       3 [0xd9f6c3]: report_fatal_error(char const*, int, char const*, ...) at ??:?\r\n       4 [0x9eef5e]: artificial_stack_t::enable_overflow_protection() at ??:?\r\n       5 [0x9f207c]: coro_t::switch_to_coro_with_protection(artificial_stack_context_ref_t*) at ??:?\r\n       6 [0x9f24eb]: coro_t::notify_now_deprecated() at ??:?\r\n       7 [0xa56bb1]: concurrent_traversal_adapter_t::handle_pair(scoped_key_value_t&&, signal_t*) at ??:?\r\n       8 [0xa6aebc]: btree_depth_first_traversal(counted_t<counted_buf_lock_and_read_t>, key_range_t const&, depth_first_traversal_callback_t*, access_t, direction_t, btree_key_t const*, btree_key_t const*, signal_t*) at ??:?\r\n       9 [0xa6ab86]: btree_depth_first_traversal(counted_t<counted_buf_lock_and_read_t>, key_range_t const&, depth_first_traversal_callback_t*, access_t, direction_t, btree_key_t const*, btree_key_t const*, signal_t*) at ??:?\r\n       10 [0xa6ab86]: btree_depth_first_traversal(counted_t<counted_buf_lock_and_read_t>, key_range_t const&, depth_first_traversal_callback_t*, access_t, direction_t, btree_key_t const*, btree_key_t const*, signal_t*) at ??:?\r\n       11 [0xa6ab86]: btree_depth_first_traversal(counted_t<counted_buf_lock_and_read_t>, key_range_t const&, depth_first_traversal_callback_t*, access_t, direction_t, btree_key_t const*, btree_key_t const*, signal_t*) at ??:?\r\n       12 [0xa6ab86]: btree_depth_first_traversal(counted_t<counted_buf_lock_and_read_t>, key_range_t const&, depth_first_traversal_callback_t*, access_t, direction_t, btree_key_t const*, btree_key_t const*, signal_t*) at ??:?\r\n       13 [0xa6b78c]: btree_depth_first_traversal(superblock_t*, key_range_t const&, depth_first_traversal_callback_t*, access_t, direction_t, release_superblock_t, signal_t*) at ??:?\r\n       14 [0xa5673f]: btree_concurrent_traversal(superblock_t*, key_range_t const&, concurrent_traversal_callback_t*, direction_t, release_superblock_t) at ??:?\r\n       15 [0x7efa16]: /usr/bin/rethinkdb() [0x7efa16] at 0x7efa16 ()\r\n       16 [0x7fd0e2]: std::_Function_handler<continue_bool_t (ql::datum_range_t const&), ql::datumspec_t::iter(sorting_t, std::function<continue_bool_t (std::pair<ql::datum_range_t, unsigned long> const&, bool)> const&) const::{lambda(ql::datum_range_t const&)#1}>::_M_invoke(std::_Any_data const&, ql::datum_range_t const&) at ??:?\r\n       17 [0x7f853a]: rdb_rget_secondary_slice(btree_slice_t*, hash_region_t<key_range_t> const&, ql::datumspec_t const&, key_range_t const&, sindex_superblock_t*, ql::env_t*, ql::batchspec_t const&, std::vector<boost::variant<ql::map_wire_func_t, ql::group_wire_func_t, ql::filter_wire_func_t, ql::concatmap_wire_func_t, ql::distinct_wire_func_t, ql::zip_wire_func_t, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_>, std::allocator<boost::variant<ql::map_wire_func_t, ql::group_wire_func_t, ql::filter_wire_func_t, ql::concatmap_wire_func_t, ql::distinct_wire_func_t, ql::zip_wire_func_t, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> > > const&, boost::optional<boost::variant<ql::count_wire_func_t, ql::sum_wire_func_t, ql::avg_wire_func_t, ql::min_wire_func_t, ql::max_wire_func_t, ql::reduce_wire_func_t, ql::limit_read_t, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_, boost::detail::variant::void_> > const&, key_range_t const&, sorting_t, require_sindexes_t, sindex_disk_info_t const&, rget_read_response_t*, release_superblock_t) at ??:?\r\n       18 [0x9a5660]: do_read(ql::env_t*, store_t*, btree_slice_t*, real_superblock_t*, rget_read_t const&, rget_read_response_t*, release_superblock_t) at ??:?\r\n       19 [0x9ab8e2]: rdb_read_visitor_t::operator()(rget_read_t const&) at ??:?\r\n       20 [0x9a5e5e]: store_t::protocol_read(read_t const&, read_response_t*, real_superblock_t*, signal_t*) at ??:?\r\n       21 [0x818168]: store_t::read(read_t const&, read_response_t*, read_token_t*, signal_t*) at ??:?\r\n       22 [0xba8af4]: direct_query_server_t::on_read(signal_t*, read_t const&, mailbox_addr_t<void (read_response_t)> const&) at ??:?\r\n       23 [0xba906b]: mailbox_t<void (read_t, mailbox_addr_t<void (read_response_t)>)>::read_impl_t::read(read_stream_t*, signal_t*) at ??:?\r\n       24 [0xa14442]: mailbox_manager_t::mailbox_read_coroutine(threadnum_t, unsigned long, std::vector<char, std::allocator<char> >*, long, mailbox_manager_t::force_yield_t) at ??:?\r\n       25 [0xa14542]: /usr/bin/rethinkdb() [0xa14542] at 0xa14542 ()\r\n       26 [0x9f2c47]: coro_t::run() at ??:?\r\nerror: Exiting.\r\n```"
  , issueCommentId = 249590947
  }