Issue
  { issueClosedAt = Just 2014 (-08) (-20) 18 : 31 : 41 UTC
  , issueUpdatedAt = 2014 (-08) (-20) 20 : 56 : 34 UTC
  , issueEventsUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/2939/events"
  , issueHtmlUrl =
      Just "https://github.com/rethinkdb/rethinkdb/issues/2939"
  , issueClosedBy = Nothing
  , issueLabels = []
  , issueNumber = 2939
  , issueAssignee = Nothing
  , issueUser =
      SimpleUser
        { simpleUserId = Id 7431361
        , simpleUserLogin = N "larkost"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/7431361?v=3"
        , simpleUserUrl = "https://api.github.com/users/larkost"
        , simpleUserType = OwnerUser
        }
  , issueTitle =
      "`TLS_get_cglobals()->coro_count < 10000` message on 1.14.0 candidate"
  , issuePullRequest = Nothing
  , issueUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/2939"
  , issueCreatedAt = 2014 (-08) (-20) 17 : 52 : 25 UTC
  , issueBody =
      Just
        "In testing the 1.14.0 candidate on newton I ran into a repeatable error on shutdown of the `split_workloads.rebalance-2-multi-serial-mix` test. The relevant line appears in the server log from one of the two servers (`serve-output-2`):\r\n```error: Assertion failed: [TLS_get_cglobals()->coro_count < 10000] Too many coroutines allocated on this thread. This is problem due to a misuse of the coroutines```\r\nThis is superficially similar to #2483, which was closed in 1.13.0. But the backtrace is different. Also note that the version on the server is misleading as it has not been bumped yet.\r\n```\r\nVersion: rethinkdb 1.13.3-1042-gf69a95 (debug) (CLANG 3.2 (tags/RELEASE_32/final))\r\nerror: Error in src/arch/runtime/coroutines.cc at line 147:\r\nerror: Assertion failed: [TLS_get_cglobals()->coro_count < 10000] Too many coroutines allocated on this thread. This is problem due to a misuse of the coroutines\r\nerror: Backtrace:\r\nerror: Wed Aug 20 09:53:50 2014\r\n       \r\n       1: rethinkdb_backtrace(void**, int) at rethinkdb_backtrace.cc:100\r\n       2: backtrace_t::backtrace_t() at backtrace.cc:203\r\n       3: lazy_backtrace_formatter_t::lazy_backtrace_formatter_t() at backtrace.cc:283\r\n       4: format_backtrace(bool) at backtrace.cc:198\r\n       5: report_fatal_error(char const*, int, char const*, ...) at errors.cc:83\r\n       6: coro_t::coro_t() at coroutines.cc:145\r\n       7: coro_t::get_coro() at coroutines.cc:381\r\n       8: /home/ssd2/larkost/rethinkdb-test-1/build/debug_clang/rethinkdb() [0x1c9d3f1] at 0x1c9d3f1 ()\r\n       9: /home/ssd2/larkost/rethinkdb-test-1/build/debug_clang/rethinkdb() [0x1c9cfa5] at 0x1c9cfa5 ()\r\n       10: mailbox_manager_t::on_message(connectivity_cluster_t::connection_t*, auto_drainer_t::lock_t, read_stream_t*) at mailbox.cc:224\r\n       11: connectivity_cluster_t::run_t::handle(keepalive_tcp_conn_stream_t*, boost::optional<peer_id_t>, boost::optional<peer_address_t>, auto_drainer_t::lock_t, bool*) at cluster.cc:1107\r\n       12: connectivity_cluster_t::run_t::connect_to_peer(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*) at cluster.cc:322\r\n       13: std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)>::operator()(connectivity_cluster_t::run_t*, peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*) const at functional:550\r\n       14: _ZNKSt5_BindIFSt7_Mem_fnIMN22connectivity_cluster_t5run_tEFvPK14peer_address_tiN5boost8optionalI9peer_id_tEEN14auto_drainer_t6lock_tEPbP14co_semaphore_tEEPS2_S5_St12_PlaceholderILi1EES9_SB_SC_P18static_semaphore_tEE8__call_cIvJRiEJLi0ELi1ELi2ELi3ELi4ELi5ELi6EEEET_OSt5tupleIJDpT0_EESt12_Index_tupleIJXspT1_EEE+0x1db at functional:1154\r\n       15: _ZNKSt5_BindIFSt7_Mem_fnIMN22connectivity_cluster_t5run_tEFvPK14peer_address_tiN5boost8optionalI9peer_id_tEEN14auto_drainer_t6lock_tEPbP14co_semaphore_tEEPS2_S5_St12_PlaceholderILi1EES9_SB_SC_P18static_semaphore_tEEclIJRiEvEET0_DpOT_+0x3d at functional:1217\r\n       16: pmap_runner_one_arg_t<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)>, int>::operator()() at pmap.hpp:23\r\n       17: callable_action_instance_t<pmap_runner_one_arg_t<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)>, int> >::run_action() at callable_action.hpp:28\r\n       18: callable_action_wrapper_t::run() at runtime_utils.cc:43\r\n       19: coro_t::run() at coroutines.cc:197\r\n       20: void coro_t::spawn_now_dangerously<pmap_runner_one_arg_t<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)>, int> >(pmap_runner_one_arg_t<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)>, int> const&) at coroutines.hpp:52\r\n       21: void pmap<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)> >(int, int, std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)> const&) at pmap.hpp:49\r\n       22: void pmap<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)> >(int, std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t const*, int, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, co_semaphore_t*)> (connectivity_cluster_t::run_t*, peer_address_t const*, std::_Placeholder<1>, boost::optional<peer_id_t>, auto_drainer_t::lock_t, bool*, static_semaphore_t*)> const&) at pmap.hpp:59\r\n       23: connectivity_cluster_t::run_t::join_blocking(peer_address_t, boost::optional<peer_id_t>, auto_drainer_t::lock_t) at cluster.cc:358\r\n       24: std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t, boost::optional<peer_id_t>, auto_drainer_t::lock_t)>::operator()(connectivity_cluster_t::run_t*, peer_address_t, boost::optional<peer_id_t>, auto_drainer_t::lock_t) const at functional:550\r\n       25: _ZNSt5_BindIFSt7_Mem_fnIMN22connectivity_cluster_t5run_tEFv14peer_address_tN5boost8optionalI9peer_id_tEEN14auto_drainer_t6lock_tEEEPS2_S3_MNS4_6detail11none_helperEiS9_EE6__callIvJEJLi0ELi1ELi2ELi3EEEET_OSt5tupleIJDpT0_EESt12_Index_tupleIJXspT1_EEE+0x159 at functional:1145\r\n       26: _ZNSt5_BindIFSt7_Mem_fnIMN22connectivity_cluster_t5run_tEFv14peer_address_tN5boost8optionalI9peer_id_tEEN14auto_drainer_t6lock_tEEEPS2_S3_MNS4_6detail11none_helperEiS9_EEclIJEvEET0_DpOT_+0x26 at functional:1203\r\n       27: callable_action_instance_t<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t, boost::optional<peer_id_t>, auto_drainer_t::lock_t)> (connectivity_cluster_t::run_t*, peer_address_t, int boost::detail::none_helper::*, auto_drainer_t::lock_t)> >::run_action() at callable_action.hpp:28\r\n       28: callable_action_wrapper_t::run() at runtime_utils.cc:43\r\n       29: coro_t::run() at coroutines.cc:197\r\n       30: void coro_t::spawn_now_dangerously<std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t, boost::optional<peer_id_t>, auto_drainer_t::lock_t)> (connectivity_cluster_t::run_t*, peer_address_t, int boost::detail::none_helper::*, auto_drainer_t::lock_t)> >(std::_Bind<std::_Mem_fn<void (connectivity_cluster_t::run_t::*)(peer_address_t, boost::optional<peer_id_t>, auto_drainer_t::lock_t)> (connectivity_cluster_t::run_t*, peer_address_t, int boost::detail::none_helper::*, auto_drainer_t::lock_t)> const&) at coroutines.hpp:52\r\n       31: connectivity_cluster_t::run_t::join(peer_address_t const&) at cluster.cc:267\r\n       32: initial_joiner_t::main_coro(connectivity_cluster_t::run_t*, auto_drainer_t::lock_t) at initial_join.cc:107\r\n       33: boost::_mfi::mf2<void, initial_joiner_t, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t>::operator()(initial_joiner_t*, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t) const at mem_fn_template.hpp:280\r\n       34: void boost::_bi::list3<boost::_bi::value<initial_joiner_t*>, boost::_bi::value<connectivity_cluster_t::run_t*>, boost::_bi::value<auto_drainer_t::lock_t> >::operator()<boost::_mfi::mf2<void, initial_joiner_t, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t>, boost::_bi::list0>(boost::_bi::type<void>, boost::_mfi::mf2<void, initial_joiner_t, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t>&, boost::_bi::list0&, int) at bind.hpp:392\r\n       35: boost::_bi::bind_t<void, boost::_mfi::mf2<void, initial_joiner_t, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t>, boost::_bi::list3<boost::_bi::value<initial_joiner_t*>, boost::_bi::value<connectivity_cluster_t::run_t*>, boost::_bi::value<auto_drainer_t::lock_t> > >::operator()() at bind_template.hpp:20\r\n       36: callable_action_instance_t<boost::_bi::bind_t<void, boost::_mfi::mf2<void, initial_joiner_t, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t>, boost::_bi::list3<boost::_bi::value<initial_joiner_t*>, boost::_bi::value<connectivity_cluster_t::run_t*>, boost::_bi::value<auto_drainer_t::lock_t> > > >::run_action() at callable_action.hpp:28\r\n       37: callable_action_wrapper_t::run() at runtime_utils.cc:43\r\n       38: coro_t::run() at coroutines.cc:197\r\n       39: coro_t* coro_t::spawn_sometime<boost::_bi::bind_t<void, boost::_mfi::mf2<void, initial_joiner_t, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t>, boost::_bi::list3<boost::_bi::value<initial_joiner_t*>, boost::_bi::value<connectivity_cluster_t::run_t*>, boost::_bi::value<auto_drainer_t::lock_t> > > >(boost::_bi::bind_t<void, boost::_mfi::mf2<void, initial_joiner_t, connectivity_cluster_t::run_t*, auto_drainer_t::lock_t>, boost::_bi::list3<boost::_bi::value<initial_joiner_t*>, boost::_bi::value<connectivity_cluster_t::run_t*>, boost::_bi::value<auto_drainer_t::lock_t> > > const&) at coroutines.hpp:58\r\n       40: initial_joiner_t::initial_joiner_t(connectivity_cluster_t*, connectivity_cluster_t::run_t*, peer_address_set_t const&, int) at initial_join.cc:87\r\n       41: do_serve(io_backender_t*, bool, base_path_t const&, metadata_persistence::cluster_persistent_file_t*, metadata_persistence::auth_persistent_file_t*, unsigned long, serve_info_t const&, os_signal_cond_t*) at serve.cc:226\r\n       42: serve(io_backender_t*, base_path_t const&, metadata_persistence::cluster_persistent_file_t*, metadata_persistence::auth_persistent_file_t*, unsigned long, serve_info_t const&, os_signal_cond_t*) at serve.cc:412\r\n       43: run_rethinkdb_serve(base_path_t const&, serve_info_t*, file_direct_io_mode_t, int, unsigned long, uuid_u const*, cluster_semilattice_metadata_t const*, directory_lock_t*, bool*) at command_line.cc:852\r\n       44: _ZNSt5_BindIFPFvRK11base_path_tP12serve_info_t21file_direct_io_mode_timPK6uuid_uPK30cluster_semilattice_metadata_tP16directory_lock_tPbES0_S4_S5_imPS6_PS9_SD_SE_EE6__callIvJEJLi0ELi1ELi2ELi3ELi4ELi5ELi6ELi7ELi8EEEET_OSt5tupleIJDpT0_EESt12_Index_tupleIJXspT1_EEE+0x1e0 at functional:1145\r\n       45: _ZNSt5_BindIFPFvRK11base_path_tP12serve_info_t21file_direct_io_mode_timPK6uuid_uPK30cluster_semilattice_metadata_tP16directory_lock_tPbES0_S4_S5_imPS6_PS9_SD_SE_EEclIJEvEET0_DpOT_+0x26 at functional:1203\r\n       46: std::_Function_handler<void (), std::_Bind<void (*(base_path_t, serve_info_t*, file_direct_io_mode_t, int, unsigned long, uuid_u*, cluster_semilattice_metadata_t*, directory_lock_t*, bool*))(base_path_t const&, serve_info_t*, file_direct_io_mode_t, int, unsigned long, uuid_u const*, cluster_semilattice_metadata_t const*, directory_lock_t*, bool*)> >::_M_invoke(std::_Any_data const&) at functional:1779\r\n       47: std::function<void ()>::operator()() const at functional:2160\r\n       48: starter_t::run_wrapper(std::function<void ()> const&) at runtime.cc:61\r\n       49: std::_Mem_fn<void (starter_t::*)(std::function<void ()> const&)>::operator()(starter_t*, std::function<void ()> const&) const at functional:550\r\n       50: _ZNSt5_BindIFSt7_Mem_fnIM9starter_tFvRKSt8functionIFvvEEEEPS1_S4_EE6__callIvJEJLi0ELi1EEEET_OSt5tupleIJDpT0_EESt12_Index_tupleIJXspT1_EEE+0x70 at functional:1145\r\n       51: _ZNSt5_BindIFSt7_Mem_fnIM9starter_tFvRKSt8functionIFvvEEEEPS1_S4_EEclIJEvEET0_DpOT_+0x26 at functional:1203\r\n       52: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (starter_t::*)(std::function<void ()> const&)> (starter_t*, std::function<void ()>)> >::_M_invoke(std::_Any_data const&) at functional:1779\r\n       53: std::function<void ()>::operator()() const at functional:2160\r\n       54: callable_action_instance_t<std::function<void ()> >::run_action() at callable_action.hpp:28\r\n       55: callable_action_wrapper_t::run() at runtime_utils.cc:43\r\n       56: coro_t::run() at coroutines.cc:197\r\n       57: coro_t* coro_t::spawn_sometime<std::function<void ()> >(std::function<void ()> const&) at coroutines.hpp:58\r\n       58: starter_t::on_thread_switch() at runtime.cc:57\r\n       59: linux_message_hub_t::on_event(int) at message_hub.cc:154\r\n       60: epoll_event_queue_t::run() at epoll.cc:115\r\n       61: linux_thread_pool_t::start_thread(void*) at thread_pool.cc:155\r\n       62: /lib/x86_64-linux-gnu/libpthread.so.0(+0x7e9a) [0x7f88e3323e9a] at 0x7f88e3323e9a (/lib/x86_64-linux-gnu/libpthread.so.0)\r\n       63: clone+0x6d at 0x7f88e305073d (/lib/x86_64-linux-gnu/libc.so.6)\r\nerror: Exiting.\r\n```\r\n"
  , issueState = "closed"
  , issueId = Id 40724998
  , issueComments = 2
  , issueMilestone =
      Just
        Milestone
          { milestoneCreator =
              SimpleUser
                { simpleUserId = Id 706854
                , simpleUserLogin = N "AtnNn"
                , simpleUserAvatarUrl =
                    "https://avatars.githubusercontent.com/u/706854?v=3"
                , simpleUserUrl = "https://api.github.com/users/AtnNn"
                , simpleUserType = OwnerUser
                }
          , milestoneDueOn = Nothing
          , milestoneOpenIssues = 1
          , milestoneNumber = 17
          , milestoneClosedIssues = 593
          , milestoneDescription =
              Just
                "The scope of this issue is covered by another issue. The closing comment should link to the other issue."
          , milestoneTitle = "duplicate"
          , milestoneUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/milestones/17"
          , milestoneCreatedAt = 2013 (-03) (-29) 20 : 23 : 12 UTC
          , milestoneState = "closed"
          }
  }