IssueComment
  { issueCommentUpdatedAt = 2013 (-08) (-07) 22 : 38 : 30 UTC
  , issueCommentUser =
      SimpleUser
        { simpleUserId = Id 258437
        , simpleUserLogin = N "srh"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/258437?v=3"
        , simpleUserUrl = "https://api.github.com/users/srh"
        , simpleUserType = OwnerUser
        }
  , issueCommentUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/comments/22289785"
  , issueCommentHtmlUrl =
      "https://github.com/rethinkdb/rethinkdb/issues/1237#issuecomment-22289785"
  , issueCommentCreatedAt = 2013 (-08) (-07) 22 : 38 : 30 UTC
  , issueCommentBody =
      "Valgrind shows it right away:\r\n\r\n```\r\nRepeating all tests (iteration 1) . . .\r\n\r\nNote: Google Test filter = BTreeSindex.LowLevelOps\r\n[==========] Running 1 test from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 1 test from BTreeSindex\r\n[ RUN      ] BTreeSindex.LowLevelOps\r\n==20168== Thread 2:\r\n==20168== Invalid read of size 2\r\n==20168==    at 0x4C2A74E: memcpy (mc_replace_strmem.c:838)\r\n==20168==    by 0x21B0655: blob_t::remove_level(mc_transaction_t*, int*) (blob.cc:855)\r\n==20168==    by 0x21AE827: blob_t::unappend_region(mc_transaction_t*, long) (blob.cc:456)\r\n==20168==    by 0x21AEAE9: blob_t::clear(mc_transaction_t*) (blob.cc:497)\r\n==20168==    by 0x25D4E90: set_secondary_indexes_internal(mc_transaction_t*, mc_buf_lock_t*, std::map<std::string, secondary_index_t, std::less<std::string>, std::allocator<std::pair<std::string const, secondary_index_t> > > const&) (secondary_operations.cc:34)\r\n==20168==    by 0x25D534F: set_secondary_index(mc_transaction_t*, mc_buf_lock_t*, std::string const&, secondary_index_t const&) (secondary_operations.cc:94)\r\n==20168==    by 0x256EAE5: unittest::run_sindex_low_level_operations_test() (btree_sindex.cc:72)\r\n==20168==    by 0x240731A: boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) (function_template.hpp:112)\r\n==20168==    by 0x1C10009: boost::function0<void>::operator()() const (function_template.hpp:760)\r\n==20168==    by 0x2228685: starter_t::run_wrapper(boost::function<void ()()> const&) (runtime.cc:55)\r\n==20168==    by 0x2229101: boost::_mfi::mf1<void, starter_t, boost::function<void ()()> const&>::operator()(starter_t*, boost::function<void ()()> const&) const (mem_fn_template.hpp:165)\r\n==20168==    by 0x2228FC2: void boost::_bi::list2<boost::_bi::value<starter_t*>, boost::_bi::value<boost::function<void ()()> > >::operator()<boost::_mfi::mf1<void, starter_t, boost::function<void ()()> const&>, boost::_bi::list0>(boost::_bi::type<void>, boost::_mfi::mf1<void, starter_t, boost::function<void ()()> const&>&, boost::_bi::list0&, int) (bind.hpp:313)\r\n==20168==  Address 0x6bd3400 is 0 bytes after a block of size 4,096 alloc'd\r\n==20168==    at 0x4C270FE: memalign (vg_replace_malloc.c:694)\r\n==20168==    by 0x4C271A7: posix_memalign (vg_replace_malloc.c:835)\r\n==20168==    by 0x2274DE4: malloc_aligned(unsigned long, unsigned long) (utils.cc:247)\r\n==20168==    by 0x21E5113: log_serializer_t::malloc() (log_serializer.cc:386)\r\n==20168==    by 0x21F77CC: serializer_data_ptr_t::init_malloc(serializer_t*) (serializer.cc:132)\r\n==20168==    by 0x21B29B7: mc_inner_buf_t::initialize_to_new(unsigned long, repli_timestamp_t) (mirrored.cc:288)\r\n==20168==    by 0x21B2B4D: mc_inner_buf_t::mc_inner_buf_t(mc_cache_t*, unsigned long, unsigned long, repli_timestamp_t) (mirrored.cc:316)\r\n==20168==    by 0x21B2868: mc_inner_buf_t::allocate(mc_cache_t*, unsigned long, repli_timestamp_t) (mirrored.cc:260)\r\n==20168==    by 0x21B3C55: mc_buf_lock_t::mc_buf_lock_t(mc_transaction_t*) (mirrored.cc:620)\r\n==20168==    by 0x21B0207: blob_t::add_level(mc_transaction_t*, int) (blob.cc:802)\r\n==20168==    by 0x21AE207: blob_t::append_region(mc_transaction_t*, long) (blob.cc:387)\r\n==20168==    by 0x25D4F21: set_secondary_indexes_internal(mc_transaction_t*, mc_buf_lock_t*, std::map<std::string, secondary_index_t, std::less<std::string>, std::allocator<std::pair<std::string const, secondary_index_t> > > const&) (secondary_operations.cc:43)\r\n==20168== \r\n==20168== Invalid read of size 2\r\n==20168==    at 0x4C2A840: memcpy (mc_replace_strmem.c:838)\r\n==20168==    by 0x21B0655: blob_t::remove_level(mc_transaction_t*, int*) (blob.cc:855)\r\n==20168==    by 0x21AE827: blob_t::unappend_region(mc_transaction_t*, long) (blob.cc:456)\r\n==20168==    by 0x21AEAE9: blob_t::clear(mc_transaction_t*) (blob.cc:497)\r\n==20168==    by 0x25D4E90: set_secondary_indexes_internal(mc_transaction_t*, mc_buf_lock_t*, std::map<std::string, secondary_index_t, std::less<std::string>, std::allocator<std::pair<std::string const, secondary_index_t> > > const&) (secondary_operations.cc:34)\r\n==20168==    by 0x25D534F: set_secondary_index(mc_transaction_t*, mc_buf_lock_t*, std::string const&, secondary_index_t const&) (secondary_operations.cc:94)\r\n==20168==    by 0x256EAE5: unittest::run_sindex_low_level_operations_test() (btree_sindex.cc:72)\r\n==20168==    by 0x240731A: boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) (function_template.hpp:112)\r\n==20168==    by 0x1C10009: boost::function0<void>::operator()() const (function_template.hpp:760)\r\n==20168==    by 0x2228685: starter_t::run_wrapper(boost::function<void ()()> const&) (runtime.cc:55)\r\n==20168==    by 0x2229101: boost::_mfi::mf1<void, starter_t, boost::function<void ()()> const&>::operator()(starter_t*, boost::function<void ()()> const&) const (mem_fn_template.hpp:165)\r\n==20168==    by 0x2228FC2: void boost::_bi::list2<boost::_bi::value<starter_t*>, boost::_bi::value<boost::function<void ()()> > >::operator()<boost::_mfi::mf1<void, starter_t, boost::function<void ()()> const&>, boost::_bi::list0>(boost::_bi::type<void>, boost::_mfi::mf1<void, starter_t, boost::function<void ()()> const&>&, boost::_bi::list0&, int) (bind.hpp:313)\r\n==20168==  Address 0x690ce00 is 0 bytes after a block of size 4,096 alloc'd\r\n==20168==    at 0x4C270FE: memalign (vg_replace_malloc.c:694)\r\n==20168==    by 0x4C271A7: posix_memalign (vg_replace_malloc.c:835)\r\n==20168==    by 0x2274DE4: malloc_aligned(unsigned long, unsigned long) (utils.cc:247)\r\n==20168==    by 0x21E5113: log_serializer_t::malloc() (log_serializer.cc:386)\r\n==20168==    by 0x21F77CC: serializer_data_ptr_t::init_malloc(serializer_t*) (serializer.cc:132)\r\n==20168==    by 0x21B29B7: mc_inner_buf_t::initialize_to_new(unsigned long, repli_timestamp_t) (mirrored.cc:288)\r\n==20168==    by 0x21B2B4D: mc_inner_buf_t::mc_inner_buf_t(mc_cache_t*, unsigned long, unsigned long, repli_timestamp_t) (mirrored.cc:316)\r\n==20168==    by 0x21B2868: mc_inner_buf_t::allocate(mc_cache_t*, unsigned long, repli_timestamp_t) (mirrored.cc:260)\r\n==20168==    by 0x21B3C55: mc_buf_lock_t::mc_buf_lock_t(mc_transaction_t*) (mirrored.cc:620)\r\n==20168==    by 0x21B0207: blob_t::add_level(mc_transaction_t*, int) (blob.cc:802)\r\n==20168==    by 0x21AE207: blob_t::append_region(mc_transaction_t*, long) (blob.cc:387)\r\n==20168==    by 0x25D4F21: set_secondary_indexes_internal(mc_transaction_t*, mc_buf_lock_t*, std::map<std::string, secondary_index_t, std::less<std::string>, std::allocator<std::pair<std::string const, secondary_index_t> > > const&) (secondary_operations.cc:43)\r\n==20168== \r\n\r\n```"
  , issueCommentId = 22289785
  }