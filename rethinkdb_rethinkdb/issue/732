Issue
  { issueClosedAt = Just 2013 (-05) (-02) 16 : 33 : 22 UTC
  , issueUpdatedAt = 2013 (-05) (-06) 21 : 32 : 28 UTC
  , issueEventsUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/732/events"
  , issueHtmlUrl =
      Just "https://github.com/rethinkdb/rethinkdb/issues/732"
  , issueClosedBy = Nothing
  , issueLabels =
      [ IssueLabel
          { labelColor = "e10c02"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/pr:high"
          , labelName = "pr:high"
          }
      , IssueLabel
          { labelColor = "e102d8"
          , labelUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/labels/tp:bug"
          , labelName = "tp:bug"
          }
      ]
  , issueNumber = 732
  , issueAssignee =
      Just
        SimpleUser
          { simpleUserId = Id 646357
          , simpleUserLogin = N "wmrowan"
          , simpleUserAvatarUrl =
              "https://avatars.githubusercontent.com/u/646357?v=3"
          , simpleUserUrl = "https://api.github.com/users/wmrowan"
          , simpleUserType = OwnerUser
          }
  , issueUser =
      SimpleUser
        { simpleUserId = Id 1461947
        , simpleUserLogin = N "neumino"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/1461947?v=3"
        , simpleUserUrl = "https://api.github.com/users/neumino"
        , simpleUserType = OwnerUser
        }
  , issueTitle = "Fix javascript driver performance"
  , issuePullRequest = Nothing
  , issueUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/732"
  , issueCreatedAt = 2013 (-04) (-27) 07 : 28 : 41 UTC
  , issueBody =
      Just
        "I cannot get huge workload with the javascript driver now as I used to get -- the bottleneck being the driver.\r\n\r\nI have a table with about 100 documents.\r\nEvery seconds I execute a function that does 100 `.get()` query. I reach a traffic or about 70 queries per seconds.\r\nI use just one connection.\r\n\r\ntotal time is the time that the scripts take to execute 1000 reads.\r\ntotal query time is the time used by the driver to compile and send the query. It's exactly the time to do r.db(\"stress\").table(\"js\").get(pk_value).run()\r\nratio = total query time / total time\r\n\r\nNote:\r\n1. I do not wait for the answer\r\n2. I was testing things on my local machine. \r\n3. And looking at htop shows that only one core was used at 100%. This core was used by node,js.\r\n\r\n\r\nDriver 1.4.0-3\r\n```\r\ntotal time       14378\r\ntotal query time 13704\r\nratio            0.953122826540548\r\n```\r\n\r\n\r\nDriver 1.4.0-0 // removing the useOutdated parameter (because it was not supported?)\r\n```\r\ntotal time       13402\r\ntotal query time 12603\r\nratio            0.9403820325324579\r\n```\r\n\r\n\r\nInteresting thing is that replacing the `.get()` query with `r.expr(1)` yields similar results (again for 1000 queries)\r\n```\r\ntotal time       9046\r\ntotal query time 7993\r\nratio            0.8835949590979438\r\n```\r\n\r\nScript used:\r\nnewton:rethinkdb/tools/simulate_traffic/build/create_traffic_for_perf.js\r\n\r\n\r\n----\r\n\r\nMore information, using the driver in `node_modules.hacked` with `create_traffic_for_perf2.js`\r\n@coffeemug mentionned something like the driver was waiting to get an answer before writing on the connection again.\r\nI run some more precise test, and I get this\r\n```\r\ntotal time       15405\r\ntotal query time 13967\r\nratio            0.9066536838688738\r\n```\r\nwhen `total query time` just check how long we spend on this line:\r\n```\r\ndata = serializer.serialize(query)\r\n```\r\n\r\nIf I print query, I get a **huge** object, see this gist https://gist.github.com/neumino/5472192\r\n\r\nSo the problem is probably that we extend in every level of `query` with a `descriptor_`, `fields_` etc."
  , issueState = "closed"
  , issueId = Id 13717644
  , issueComments = 17
  , issueMilestone =
      Just
        Milestone
          { milestoneCreator =
              SimpleUser
                { simpleUserId = Id 48436
                , simpleUserLogin = N "coffeemug"
                , simpleUserAvatarUrl =
                    "https://avatars.githubusercontent.com/u/48436?v=3"
                , simpleUserUrl = "https://api.github.com/users/coffeemug"
                , simpleUserType = OwnerUser
                }
          , milestoneDueOn = Just 2013 (-05) (-15) 07 : 00 : 00 UTC
          , milestoneOpenIssues = 0
          , milestoneNumber = 8
          , milestoneClosedIssues = 183
          , milestoneDescription =
              Just "Issues that are absolutely necessary for 1.5."
          , milestoneTitle = "1.5"
          , milestoneUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/milestones/8"
          , milestoneCreatedAt = 2013 (-03) (-20) 02 : 06 : 44 UTC
          , milestoneState = "closed"
          }
  }