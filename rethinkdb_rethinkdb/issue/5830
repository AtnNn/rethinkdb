Issue
  { issueClosedAt = Just 2016 (-06) (-08) 02 : 38 : 33 UTC
  , issueUpdatedAt = 2016 (-06) (-10) 02 : 28 : 55 UTC
  , issueEventsUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5830/events"
  , issueHtmlUrl =
      Just "https://github.com/rethinkdb/rethinkdb/issues/5830"
  , issueClosedBy = Nothing
  , issueLabels = []
  , issueNumber = 5830
  , issueAssignee = Nothing
  , issueUser =
      SimpleUser
        { simpleUserId = Id 1430058
        , simpleUserLogin = N "ntquyen"
        , simpleUserAvatarUrl =
            "https://avatars.githubusercontent.com/u/1430058?v=3"
        , simpleUserUrl = "https://api.github.com/users/ntquyen"
        , simpleUserType = OwnerUser
        }
  , issueTitle = "Two separated clusters unexpectedly join together"
  , issuePullRequest = Nothing
  , issueUrl =
      "https://api.github.com/repos/rethinkdb/rethinkdb/issues/5830"
  , issueCreatedAt = 2016 (-06) (-06) 06 : 11 : 32 UTC
  , issueBody =
      Just
        "I'm running two separated clusters (version 2.2.5), each has 3 nodes, in 4 CoreOS machines and inside docker containers. Each cluster is configured correctly and is working fine until now, they joined, or merge into one single cluster of 6 nodes, without any change in configuration.\r\n\r\nLet me explain in more detail config of the two clusters. \r\n- Let A, B, C, D denote the four machines.\r\n- Cluster 1 has 3 nodes running in A, B, C\r\n- Cluster 2 has 3 nodes running in A, B, D\r\n- Cluster 1 has 1 rethinkdb-proxy running in A, \r\n- Cluster 2 has 1 rethinkdb-proxy also running in A\r\n\r\nAfter I shutdown some hanging containers (different containers) running in A, the docker daemon was hung. When docker daemon came backup, I realized that the 2 separate clusters have become one single cluster, all 6 nodes are listed in rethinkdb admin UI.\r\n\r\nDetailed log_file from one node in machine A:\r\n\r\n```\r\n2016-06-06T03:13:56.144428976 0.453596s notice: Running rethinkdb 2.2.5~0jessie (GCC 4.9.2)...\r\n2016-06-06T03:13:56.366566527 0.675732s notice: Running on Linux 4.3.6-coreos x86_64\r\n2016-06-06T03:13:56.366657828 0.675820s notice: Loading data from directory /data\r\n2016-06-06T03:13:56.624671869 0.933837s info: Cache size is set to 2000 MB\r\n2016-06-06T03:13:56.625435082 0.934597s notice: Listening for intracluster connections on port 29015\r\n2016-06-06T03:13:56.625756287 0.934918s info: Attempting connection to 1 peer...\r\n2016-06-06T03:13:56.630081458 0.939244s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:13:56.648550061 0.957713s notice: Connected to server \"02f81613b7c0_wdx\" 8138c225-e59c-4e5c-8f2e-93a5689aea47\r\n2016-06-06T03:13:56.653839848 0.963002s notice: Connected to proxy d773f977-bfd3-4a45-849b-855d4fa8ddb3\r\n2016-06-06T03:13:56.657699712 0.966862s notice: Connected to server \"c1d17389be70_29y\" d5a8f7d7-33b2-4f60-9561-38d4a9d163e1\r\n2016-06-06T03:13:56.790790999 1.099954s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:13:57.019060751 1.328223s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:13:57.312373270 1.621536s info: Rejected a connection from server c0271963-846f-43d9-a9cd-891d780c5c57 since one is open already.\r\n2016-06-06T03:14:01.439251633 5.748414s info: Rejected a connection from server c0271963-846f-43d9-a9cd-891d780c5c57 since one is open already.\r\n2016-06-06T03:14:03.244422764 7.553587s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:14:03.472167443 7.781330s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:14:07.892475345 12.201638s info: Rejected a connection from server c0271963-846f-43d9-a9cd-891d780c5c57 since one is open already.\r\n2016-06-06T03:14:12.923415905 17.232580s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:14:13.151856195 17.461022s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:14:17.571921119 21.881085s info: Rejected a connection from server c0271963-846f-43d9-a9cd-891d780c5c57 since one is open already.\r\n2016-06-06T03:14:27.442694971 31.751859s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:14:27.670475238 31.979638s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:14:32.090160301 36.399325s info: Rejected a connection from server c0271963-846f-43d9-a9cd-891d780c5c57 since one is open already.\r\n2016-06-06T03:14:42.442994512 46.752164s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:14:42.670028454 46.979191s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:14:43.002474040 47.311636s notice: Listening for client driver connections on port 28015\r\n2016-06-06T03:14:43.002592542 47.311755s notice: Listening for administrative HTTP connections on port 8080\r\n2016-06-06T03:14:43.101103778 47.410266s notice: Listening on addresses: 127.0.0.1, 10.2.42.2, ::1, fe80::42:aff:fe02:2a02%7\r\n2016-06-06T03:14:43.101181979 47.410344s notice: Server ready, \"4200b06bc82d_1yx\" 83a15f4a-a772-4649-b866-d537e5c0cfba\r\n2016-06-06T03:14:44.062024964 48.371187s notice: A newer version of the RethinkDB server is available: 2.3.3. You can read the changelog at <https://github.com/rethinkdb/rethinkdb/releases>.\r\n2016-06-06T03:15:09.381395928 0.649097s notice: Running rethinkdb 2.2.5~0jessie (GCC 4.9.2)...\r\n2016-06-06T03:15:09.554297676 0.821998s notice: Running on Linux 4.3.6-coreos x86_64\r\n2016-06-06T03:15:09.554433778 0.822131s notice: Loading data from directory /data\r\n2016-06-06T03:15:10.020497855 1.288197s info: Cache size is set to 2000 MB\r\n2016-06-06T03:15:10.020822560 1.288520s warn: Cache size is larger than available memory.\r\n2016-06-06T03:15:10.024062914 1.291760s notice: Listening for intracluster connections on port 29015\r\n2016-06-06T03:15:10.024313718 1.292011s info: Attempting connection to 1 peer...\r\n2016-06-06T03:15:10.029235099 1.296932s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:15:10.066466912 1.334164s notice: Connected to server \"02f81613b7c0_wdx\" 8138c225-e59c-4e5c-8f2e-93a5689aea47\r\n2016-06-06T03:15:10.084021401 1.351719s notice: Connected to server \"c1d17389be70_29y\" d5a8f7d7-33b2-4f60-9561-38d4a9d163e1\r\n2016-06-06T03:15:10.084063502 1.351761s notice: Connected to proxy d773f977-bfd3-4a45-849b-855d4fa8ddb3\r\n2016-06-06T03:15:11.487058601 2.754756s info: Rejected a connection from server c0271963-846f-43d9-a9cd-891d780c5c57 since one is open already.\r\n2016-06-06T03:20:35.880660573 0.683492s notice: Running rethinkdb 2.2.5~0jessie (GCC 4.9.2)...\r\n2016-06-06T03:20:36.123374090 0.926204s notice: Running on Linux 4.3.6-coreos x86_64\r\n2016-06-06T03:20:36.123507892 0.926335s notice: Loading data from directory /data\r\n2016-06-06T03:20:36.670148339 1.472977s info: Cache size is set to 2000 MB\r\n2016-06-06T03:20:36.670875350 1.473702s notice: Listening for intracluster connections on port 29015\r\n2016-06-06T03:20:36.671079753 1.473907s info: Attempting connection to 1 peer...\r\n2016-06-06T03:20:36.675975826 1.478803s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:20:36.702146116 1.504974s notice: Connected to server \"02f81613b7c0_wdx\" 8138c225-e59c-4e5c-8f2e-93a5689aea47\r\n2016-06-06T03:20:36.788480003 1.591308s notice: Connected to proxy 2b8ecb70-baf9-46d1-bbe2-2fa761928f1f\r\n2016-06-06T03:20:36.791876853 1.594704s notice: Connected to server \"bce59c7ef449_2j3\" 5b67e7c7-2a29-45e8-af14-02cf59a30161\r\n2016-06-06T03:20:36.791908554 1.594735s notice: Connected to server \"82d010b06bfd_t9r\" 2719bd37-d195-4e1f-8139-1d368a285a52\r\n2016-06-06T03:20:36.809369314 1.612197s notice: Connected to server \"2ffc53ac255e_fc0\" ed454b62-4d7e-4a49-8b44-084f2680f068\r\n2016-06-06T03:20:36.816865126 1.619693s notice: Connected to server \"c1d17389be70_29y\" d5a8f7d7-33b2-4f60-9561-38d4a9d163e1\r\n2016-06-06T03:20:36.949081396 1.751909s notice: Connected to proxy 87b61462-746b-47d6-b732-aaf5932570ce\r\n2016-06-06T03:20:38.220576243 3.023404s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:20:38.265315509 3.068143s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:20:42.793320950 7.596152s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:20:42.834491963 7.637320s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:20:53.219381664 18.022211s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:20:53.265930256 18.068758s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:20:57.793755643 22.596585s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:20:57.818069604 22.620898s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:21:08.219367906 33.022197s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:21:08.266262701 33.069090s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:21:12.793852938 37.596683s info: Rejected a connection from server 8138c225-e59c-4e5c-8f2e-93a5689aea47 since one is open already.\r\n2016-06-06T03:21:12.819059612 37.621887s info: Rejected a connection from server d5a8f7d7-33b2-4f60-9561-38d4a9d163e1 since one is open already.\r\n2016-06-06T03:21:16.768468939 41.571296s notice: Listening for client driver connections on port 28015\r\n2016-06-06T03:21:16.768961046 41.571788s notice: Listening for administrative HTTP connections on port 8080\r\n2016-06-06T03:21:16.825195579 41.628023s notice: Listening on addresses: 127.0.0.1, 10.2.42.2, ::1, fe80::42:aff:fe02:2a02%1055\r\n2016-06-06T03:21:16.825307281 41.628134s notice: Server ready, \"4200b06bc82d_1yx\" 83a15f4a-a772-4649-b866-d537e5c0cfba\r\n2016-06-06T03:21:18.579967973 43.382795s notice: A newer version of the RethinkDB server is available: 2.3.3. You can read the changelog at <https://github.com/rethinkdb/rethinkdb/releases>.\r\n2016-06-06T03:44:41.918844646 1446.721672s notice: Disconnected from proxy 2b8ecb70-baf9-46d1-bbe2-2fa761928f1f\r\n2016-06-06T03:44:41.962625350 1446.765453s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:44:41.963043256 1446.765870s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:44:42.037811888 1446.840639s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:44:42.038188393 1446.841016s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:44:42.151142653 1446.953970s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:44:42.151806762 1446.954634s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n2016-06-06T03:44:42.318463163 1447.121291s info: Rejected a connection from server 83a15f4a-a772-4649-b866-d537e5c0cfba since one is open already.\r\n```\r\n\r\nAs you can see, at 2016-06-06T03:13:56, this node was connected to only 2 other nodes and 1 proxy in the same cluster, which is OK. But at 2016-06-06T03:20:36, it started to connect 5 other nodes and 2 proxies.\r\nThe log doesn't tell much in detail, but I'm pretty sure it is because of something wrong the rethink proxies. Because along with these 2 clusters, I'm also running other clusters, but they don't get joined because they don't have any proxy. These two clusters are the only ones that have proxy and they are running in the same machine A. \r\n\r\nThere was also something interesting in the log right before the merge : `2016-06-06T03:20:36.671079753 1.473907s info: Attempting connection to 1 peer...` I guess the indicated `peer` here is likely the proxy...\r\n"
  , issueState = "closed"
  , issueId = Id 158607090
  , issueComments = 6
  , issueMilestone =
      Just
        Milestone
          { milestoneCreator =
              SimpleUser
                { simpleUserId = Id 706854
                , simpleUserLogin = N "AtnNn"
                , simpleUserAvatarUrl =
                    "https://avatars.githubusercontent.com/u/706854?v=3"
                , simpleUserUrl = "https://api.github.com/users/AtnNn"
                , simpleUserType = OwnerUser
                }
          , milestoneDueOn = Nothing
          , milestoneOpenIssues = 0
          , milestoneNumber = 19
          , milestoneClosedIssues = 174
          , milestoneDescription =
              Just
                "It's a feature. The issue describes a RethinkDB feature or design choice as if it was a bug."
          , milestoneTitle = "notabug"
          , milestoneUrl =
              "https://api.github.com/repos/rethinkdb/rethinkdb/milestones/19"
          , milestoneCreatedAt = 2013 (-03) (-29) 21 : 07 : 05 UTC
          , milestoneState = "closed"
          }
  }